%!PS-Adobe-2.0
%%Creator: dvips 5.51 Copyright 1986, 1993 Radical Eye Software
%%Title: paper.dvi
%%CreationDate: Fri Dec  2 17:22:43 1994
%%Pages: 11
%%PageOrder: Ascend
%%BoundingBox: 0 0 612 792
%%DocumentFonts: Palatino-Roman Courier Palatino-Italic Palatino-Bold
%%EndComments
%DVIPSCommandLine: dvips paper.dvi -o paper.ps
%DVIPSSource:  TeX output 1994.11.13:0153
%%BeginProcSet: tex.pro
/TeXDict 250 dict def TeXDict begin /N{def}def /B{bind def}N /S{exch}N /X{S N}
B /TR{translate}N /isls false N /vsize 11 72 mul N /@rigin{isls{[0 -1 1 0 0 0]
concat}if 72 Resolution div 72 VResolution div neg scale isls{Resolution hsize
-72 div mul 0 TR}if Resolution VResolution vsize -72 div 1 add mul TR matrix
currentmatrix dup dup 4 get round 4 exch put dup dup 5 get round 5 exch put
setmatrix}N /@landscape{/isls true N}B /@manualfeed{statusdict /manualfeed
true put}B /@copies{/#copies X}B /FMat[1 0 0 -1 0 0]N /FBB[0 0 0 0]N /nn 0 N
/IE 0 N /ctr 0 N /df-tail{/nn 8 dict N nn begin /FontType 3 N /FontMatrix
fntrx N /FontBBox FBB N string /base X array /BitMaps X /BuildChar{
CharBuilder}N /Encoding IE N end dup{/foo setfont}2 array copy cvx N load 0 nn
put /ctr 0 N[}B /df{/sf 1 N /fntrx FMat N df-tail}B /dfs{div /sf X /fntrx[sf 0
0 sf neg 0 0]N df-tail}B /E{pop nn dup definefont setfont}B /ch-width{ch-data
dup length 5 sub get}B /ch-height{ch-data dup length 4 sub get}B /ch-xoff{128
ch-data dup length 3 sub get sub}B /ch-yoff{ch-data dup length 2 sub get 127
sub}B /ch-dx{ch-data dup length 1 sub get}B /ch-image{ch-data dup type
/stringtype ne{ctr get /ctr ctr 1 add N}if}B /id 0 N /rw 0 N /rc 0 N /gp 0 N
/cp 0 N /G 0 N /sf 0 N /CharBuilder{save 3 1 roll S dup /base get 2 index get
S /BitMaps get S get /ch-data X pop /ctr 0 N ch-dx 0 ch-xoff ch-yoff ch-height
sub ch-xoff ch-width add ch-yoff setcachedevice ch-width ch-height true[1 0 0
-1 -.1 ch-xoff sub ch-yoff .1 add]{ch-image}imagemask restore}B /D{/cc X dup
type /stringtype ne{]}if nn /base get cc ctr put nn /BitMaps get S ctr S sf 1
ne{dup dup length 1 sub dup 2 index S get sf div put}if put /ctr ctr 1 add N}
B /I{cc 1 add D}B /bop{userdict /bop-hook known{bop-hook}if /SI save N @rigin
0 0 moveto /V matrix currentmatrix dup 1 get dup mul exch 0 get dup mul add
.99 lt{/QV}{/RV}ifelse load def pop pop}N /eop{SI restore showpage userdict
/eop-hook known{eop-hook}if}N /@start{userdict /start-hook known{start-hook}
if pop /VResolution X /Resolution X 1000 div /DVImag X /IE 256 array N 0 1 255
{IE S 1 string dup 0 3 index put cvn put}for 65781.76 div /vsize X 65781.76
div /hsize X}N /p{show}N /RMat[1 0 0 -1 0 0]N /BDot 260 string N /rulex 0 N
/ruley 0 N /v{/ruley X /rulex X V}B /V{}B /RV statusdict begin /product where{
pop product dup length 7 ge{0 7 getinterval dup(Display)eq exch 0 4
getinterval(NeXT)eq or}{pop false}ifelse}{false}ifelse end{{gsave TR -.1 -.1
TR 1 1 scale rulex ruley false RMat{BDot}imagemask grestore}}{{gsave TR -.1
-.1 TR rulex ruley scale 1 1 false RMat{BDot}imagemask grestore}}ifelse B /QV{
gsave transform round exch round exch itransform moveto rulex 0 rlineto 0
ruley neg rlineto rulex neg 0 rlineto fill grestore}B /a{moveto}B /delta 0 N
/tail{dup /delta X 0 rmoveto}B /M{S p delta add tail}B /b{S p tail}B /c{-4 M}
B /d{-3 M}B /e{-2 M}B /f{-1 M}B /g{0 M}B /h{1 M}B /i{2 M}B /j{3 M}B /k{4 M}B
/w{0 rmoveto}B /l{p -4 w}B /m{p -3 w}B /n{p -2 w}B /o{p -1 w}B /q{p 1 w}B /r{
p 2 w}B /s{p 3 w}B /t{p 4 w}B /x{0 S rmoveto}B /y{3 2 roll p a}B /bos{/SS save
N}B /eos{SS restore}B end
%%EndProcSet
%%BeginProcSet: texps.pro
TeXDict begin /rf{findfont dup length 1 add dict begin{1 index /FID ne 2 index
/UniqueID ne and{def}{pop pop}ifelse}forall[1 index 0 6 -1 roll exec 0 exch 5
-1 roll VResolution Resolution div mul neg 0 0]/Metrics exch def dict begin
Encoding{exch dup type /integertype ne{pop pop 1 sub dup 0 le{pop}{[}ifelse}{
FontMatrix 0 get div Metrics 0 get div def}ifelse}forall Metrics /Metrics
currentdict end def[2 index currentdict end definefont 3 -1 roll makefont
/setfont load]cvx def}def /ObliqueSlant{dup sin S cos div neg}B /SlantFont{4
index mul add}def /ExtendFont{3 -1 roll mul exch}def /ReEncodeFont{/Encoding
exch def}def end
%%EndProcSet
TeXDict begin 40258431 52099146 1000 300 300
(/homes/systems/liangs/pmonads/paper/paper.dvi) @start /Fa
2 55 df<8000F000FC00FF00FFE0FFFEFFFEFFE0FF00FC00F00080000F0C67852A>45
D<06000600060006000F000F000F001F801F803FC03FC07FE07FE07FE0FFF00C0F86A72A>54
D E /Fb 2 42 df<0408103020606040C0C0C0C0C0C0C0C0C0C04060602030100804061A7D920C
>40 D<80402030101818080C0C0C0C0C0C0C0C0C0C0818181030204080061A7F920C>I
E /Fc 6 117 df<3FF87FF8C2008600040004000C000C000C00180018000D0B7E8A0E>28
D<40E060202040408003087D8209>59 D<000400000E00000E0000160000260000260000460000
870000830001030003FF00020300040300080300080180100180FC0FE013117E9017>65
D<072018E0306060606060C0C0C0C0C0C841C862D03C600D0B7E8A11>97
D<71F1F09A1A189C1C18981818181818303030303030303032303062606064606038170B7E8A1B
>109 D<08181818FF30303030606062646438080F7E8E0C>116 D E /Fd
2 49 df<0000400000C0000060000060000030000018FFFFFFFFFFFF0000180000300000600000
600000C0000040180E7D8C1E>33 D<081C1C3838383070706060C0C0060D7E8D09>48
D E /Fe 32 123 df<1FFF803FFF807FFF00408000808000018000018000018000030000030000
0300000700000700000700000E000006000011107E8F11>28 D<60F0F06004047D830B>58
D<60F0F07010101020204040040B7D830B>I<0004000C00180018001800300030003000600060
006000C000C000C00180018001800300030003000600060006000C000C000C0018001800180030
0030003000600060006000C000C0000E257E9B13>61 D<E000007800001E000007800001E00000
7800001E000007800001E000007800001E00001E0000780001E0000780001E0000780001E00007
80001E0000780000E0000017167D931E>I<000010000000300000007000000070000000F80000
00B80000013800000238000002380000043800000C38000008380000103C0000101C0000201C00
00401C00007FFC0000801C0000801C0001001C0002001C0002000E0004000E000C000E001C000E
00FF00FFC01A1A7F991D>65 D<03FFFFC0007001C0007000C00070004000E0004000E0004000E0
004000E0004001C0200001C0200001C0200001C0600003FFC0000380C000038040000380400007
0080000700010007000100070002000E0002000E0006000E0004000E000C001C003800FFFFF800
1A1A7E991C>69 D<03FF8000700000700000700000E00000E00000E00000E00001C00001C00001
C00001C0000380000380000380000380000700000700040700040700080E00080E00180E00300E
00701C01E0FFFFE0161A7E991A>76 D<03F80003F800780007800078000B800078000B80009C00
1700009C001700009C002700009C004700011C004E00011C008E00011C010E00010E010E00020E
021C00020E041C00020E041C00020E081C00040E083800040E103800040E203800040720380008
07407000080780700008078070001807007000380600E000FF0607FE00251A7E9925>I<03FFF8
0000700F00007007800070038000E003C000E003C000E003C000E003C001C0078001C0070001C0
1E0001C0780003FFC000038060000380300003803800070038000700380007003800070038000E
0078000E0078000E0078400E0078801C003C80FFC01F001A1A7E991D>82
D<001F080060D800803801003803001006001006001006001006000007000007C00003FC0001FF
00007F80000FC00001C00001C00000C02000C02000C0600180600180600300700600CC1C0083F0
00151A7E9917>I<3FFFFF80380E0180200E0080400E0080401C0080801C0080801C0080801C00
80003800000038000000380000003800000070000000700000007000000070000000E0000000E0
000000E0000000E0000001C0000001C0000001C0000001C0000003C000007FFC0000191A7F9916
>I<03E606171C0E380E300E700E601CE01CE01CE01CE039C039E0396079219A1E0E10107F8F14>
97 D<7E000E000E000E001C001C001C001C003800380039E03E107818701C700C701CE01CE01C
E01CE018E038C030E07060E021801F000E1A7F9910>I<01F0070C0C0C181C300870006000E000
E000E000E000E004E008601030600F800E107F8F11>I<01F006081C04380470047008FFF0E000
E000E000E000E0046008601030600F800E107F8F12>101 D<0007C0000C60001CE00018C00038
0000380000380000380000700000700007FF0000700000700000E00000E00000E00000E00000E0
0001C00001C00001C00001C00001C00001C000038000038000038000030000030000670000E600
00CC000078000013217E9913>I<1F80000380000380000380000700000700000700000700000E
00000E00000E3E000EC7001D03801E03801C03801C0380380700380700380700380E00700E4070
0E40701C40701C80E00C80600700121A7F9916>104 D<03000380030000000000000000000000
000000003C004E004E008E008E009C001C001C0038003800390071007100720072003C00091A7E
990D>I<000200070006000000000000000000000000000000700198021C021C041C041C003800
3800380038007000700070007000E000E000E000E001C061C0E380C7007C001021809910>I<1F
80000380000380000380000700000700000700000700000E00000E00000E07000E19801C23801C
41801C80001D00003E00003FC00038E000387000707100707100707100707200E03200601C0011
1A7F9914>I<3F0707070E0E0E0E1C1C1C1C3838383870707070E2E2E2E46438081A7F990B>I<38
3E0F804CC330C08F03C0E08F03C0E08E0380E08E0380E01C0701C01C0701C01C0701C01C070380
380E0388380E0388380E0708380E0710701C0320300C01C01D107E8F22>I<703E0058C7009D03
809E03809C03809C0380380700380700380700380E00700E40700E40701C40701C80E00C806007
0012107E8F17>I<01F0070C0C061807300770076007E007E007E006E00EE00CE018603030E00F
8010107F8F13>I<30F059189E389C189C009C0038003800380038007000700070007000E00060
000D107E8F11>114 D<03E006180818183818301C001FC00FE007F000700030E030E030806040
C03F000D107E8F12>I<06000E000E000E000E001C001C00FFE01C003800380038003800700070
0070007000E080E080E100E100660038000B177E960E>I<380C4C0E4E0E8E069C069C061C0438
0438043808700870083010382018400F800F107E8F13>118 D<07878008C8C010F1C020E0C020
E00020E00001C00001C00001C00001C000038100038100C38100E58200C5840078780012107F8F
16>120 D<3803004C03804E07008E07009C07009C07001C0E00380E00380E00380E00701C0070
1C00701C00303C001878000FB800003800007000607000E0E000C0C0004380003E000011177E8F
13>I<038107C20FFC10041008003000400080010002000C041004200C3FF841F080E010107F8F
12>I E /Ff 9 111 df<60F0F06004047D8A0B>1 D<0300030003000300E31C73381FE0078007
801FE07338E31C03000300030003000E107E9013>3 D<00000180000000018000000000C00000
0000C00000000060000000006000000000300000000018000000000C00FFFFFFFF80FFFFFFFF80
0000000C000000001800000000300000000060000000006000000000C000000000C00000000180
00000001800021147E9226>33 D<000018000000000C000000000C000000000600000000070000
0000030000FFFFFFC000FFFFFFE00000000038000000001E0000000007800000000E0000000038
000000007000FFFFFFC000FFFFFF800000000300000000060000000006000000000C000000000C
0000000018000021167E9326>41 D<0001F00007F80008F800307800707000E06000E00001C000
01C00003C0000380000380000780000700000700000F00000E00000E00001E00001C00001C000C
38001C3FC0387FFC30E3FFC0803F80161A7E991A>76 D<7F80FF80C000C000C000C000C000C000
C000C000C000C000C000C000C000C000C000C000C000C000C000C000C000C000C000C000C000C0
00C000C000C000C000C000C000C000C000C000400009267A9B11>100 D<FF80FF800180018001
800180018001800180018001800180018001800180018001800180018001800180018001800180
0180018001800180018001800180018001800180018001800180008009267F9B11>I<C0C0C0C0
C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C002257C9B0B>
106 D<C000C0006000600060003000300030001800180018000C000C000C000600060006000300
0300030001800180018000C000C000C0006000600060003000300030001800180018000C00040E
257E9B13>110 D E /Fg 6 94 df<00800100020004000C000800180030003000300060006000
60006000E000E000E000E000E000E000E000E000E000E000600060006000600030003000300018
0008000C00040002000100008009267D9B0F>40 D<8000400020001000180008000C0006000600
060003000300030003000380038003800380038003800380038003800380030003000300030006
00060006000C0008001800100020004000800009267E9B0F>I<000C0000000C0000000C000000
0C0000000C0000000C0000000C0000000C0000000C0000000C0000000C0000000C0000FFFFFF80
FFFFFF80000C0000000C0000000C0000000C0000000C0000000C0000000C0000000C0000000C00
00000C0000000C0000000C0000191A7E951E>43 D<FFFFFF80FFFFFF8000000000000000000000
0000000000000000000000000000FFFFFF80FFFFFF80190A7E8D1E>61 D<FEFEC0C0C0C0C0C0C0
C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0C0FEFE07257D9B0B>91
D<FEFE060606060606060606060606060606060606060606060606060606060606060606FEFE07
25809B0B>93 D E /Fh 134[21 1[31 1[23 12 17 15 1[23 21 23 1[12
2[12 23 1[15 19 23 17 1[19 26[21 70[{}18 37.500000 /Palatino-Bold
rf /Fi 134[15 4[10 11 11 1[15 2[23 3[8 3[11 15 12 1[13 12[18
16 83[{}13 29.166668 /Palatino-Italic rf /Fj 202[10 10 10 10
10 49[{}5 20.833334 /Palatino-Roman rf /Fk 202[12 12 12 12
12 12 48[{}6 25.000000 /Palatino-Roman rf /Fl 134[17 3[18 1[13
13 1[17 15 18 26 9 2[9 1[17 9 13 17 14 1[15 12[20 18 22 1[20
26 26 31 18 2[11 1[24 18 2[22 1[24 6[8 17 3[17 2[17 4[11 8
4[9 39[{}36 33.333332 /Palatino-Italic rf /Fm 134[18 3[20 2[13
1[20 18 19 4[10 3[16 3[17 12[20 9[11 16[17 3[17 3[17 2[8 1[8
44[{}16 33.333332 /Palatino-Roman rf /Fn 138[17 17 17 2[17
17 17 17 1[17 17 6[17 1[17 32[17 17[17 46[{}13 29.166668 /Courier
rf /Fo 69[15 10[18 18 3[15 47[15 16 15 24 16 18 9 12 11 1[17
16 17 26 8 16 7 8 17 16 10 14 18 13 16 15 3[10 1[10 3[29 21
23 18 15 19 1[18 23 24 4[10 1[22 16 18 22 21 1[23 5[7 7 15
15 15 1[15 15 15 15 15 15 1[7 10 7 2[10 10 8 39[{}64 29.166668
/Palatino-Roman rf /Fp 2 122 df<1818DBFF18FFDB181808097D890F>3
D<0C000C000C000C00FFC0FFC00C000C000C000C000C000C000C000C000C000C000C000C000A12
7E8D0F>121 D E /Fq 81[20 52[19 19 27 19 21 12 15 15 17 19 17
21 29 10 17 10 10 19 19 10 15 19 15 17 17 10 9[27 29 23 21
25 1[23 29 29 35 21 1[12 12 1[27 21 23 29 25 1[27 6[9 19 4[19
19 19 19 19 11 9 12 9 23 1[12 12 10 4[19 34[{}61 37.500000
/Palatino-Italic rf /Fr 47[37 21[19 8[19 1[23 23 3[19 47[19
21 19 31 21 23 12 16 15 21 22 20 22 33 11 21 9 11 22 21 12
18 23 17 21 19 10 2[12 1[12 25 25 1[37 27 29 23 20 25 29 23
29 31 35 23 27 12 13 31 29 21 23 29 26 23 29 1[17 3[9 9 19
19 19 19 19 19 19 19 19 19 23 9 12 9 23 1[12 12 10 29 4[10
33[{}83 37.500000 /Palatino-Roman rf /Fs 52 123 df<F8F8F8F8F8307060E005097D84
0B>44 D<F8F8F8F8F805057D840B>46 D<01C003C01FC0FFC0FFC067C007C007C007C007C007C0
07C007C007C007C007C007C007C007C007C007C007C007C07FFCFFFC7FFC0E1A7D9915>49
D<07E01FF03FFC7FFEF87EF03F603F201F001F003F003F003E007C007C00F801F003E007800F00
0E001C0038007FFFFFFFFFFF7FFF101A7E9915>I<0FE03FF87FFCFFFC707E407E003E007E007E
00FC07F807F007F8007C003E003F003F003F003F403F603FF87EFFFE7FFC3FF80FE0101A7E9915
>I<00FC0000FC0001FC0001FC0003BC0007BC00073C000F3C000F3C001E3C001E3C003C3C003C
3C00783C00783C00F03C00FFFFC0FFFFC0FFFFC0FFFFC0003C00003C00003C00003C00003C0000
3C00121A7F9915>I<1FFF003FFF003FFF003FFF003E00003E00003E00003E00003E00003E0000
3FF8003FFC003FFE003E1F001C1F80001F80001F80001F80201F80601F80701F80F83F007FFF00
3FFE001FFC0007F000111A7F9915>I<01F007F81FF81FF83F087C007C007800F800F8F0FBFCFF
FEFE3EFC1FF81FF81FF81FF81FF81F781F7C1F7C3E3FFE1FFC0FF807E0101A7E9915>I<FFFFFF
FFFFFFFFFF001E003C007C00F800F801F001F003E003E007E007C00FC00FC00FC00F801F801F80
1F801F801F801F801F80101A7E9915>I<0FF03FFC7FFE7FFEFC3FF81FF81FF81FF81F781E7FFE
1FF81FF87E7E7C3EF81FF81FF81FF81FF81FF81F7C3E7FFE3FFC1FF807E0101A7E9915>I<07E0
1FF03FFC7FFC7C3EF83EF81EF81FF81FF81FF81FF81FF83F7C7F7FFF3FDF0F1F001F001E003E00
3E307C3FFC7FF83FF00FC0101A7E9915>I<1FC07FF0FFF8F07C607C407C007C00FC01F801F003
E007C00780078007800780078007000000000000000F800F800F800F8007800E1A7E9913>63
D<00FC0001FE0001FE0003FF0003FF0003DF0003DF0007DF80079F80078F800F8FC00F8FC00F0F
C01F07E01F07E01E07E03E03F03FFFF03FFFF07FFFF87C01F87801F8F800FCF800FCF800FCF000
7C161A7E991B>65 D<7FFE00FFFF80FFFFC0FC0FE0FC03F0FC03F0FC03F0FC03F0FC03F0FC03E0
FC0FE0FFFFC0FFFF80FFFFE0FC07F0FC03F0FC01F8FC01F8FC01F8FC01F8FC01F8FC03F8FC07F0
FFFFE0FFFFC07FFF00151A7D991B>I<007FC003FFF80FFFF81FFFF83FC0703F00107E00007E00
007E0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC00007E00007E00007E00003F00
083FC0781FFFF80FFFF803FFF0007F80151A7E991A>I<7FFFC0FFFFC0FFFFC0FFFFC0FC0000FC
0000FC0000FC0000FC0000FC0000FC0000FFFF80FFFF80FFFF80FFFF80FC0000FC0000FC0000FC
0000FC0000FC0000FC0000FFFFC0FFFFC0FFFFC07FFFC0121A7D9918>69
D<7FFF80FFFF80FFFF80FFFF80FC0000FC0000FC0000FC0000FC0000FC0000FC0000FFFF00FFFF
00FFFF00FFFF00FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC0000FC00007C00
00111A7D9917>I<7CFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFCFC7C061A7D990C>
73 D<7C00FC00FC00FC00FC00FC00FC00FC00FC00FC00FC00FC00FC00FC00FC00FC00FC00FC00
FC00FC00FC00FC00FFFFFFFFFFFF7FFF101A7D9916>76 D<7E0001FCFF0003FCFF0003FCFF0003
FCFF8007FCF780077CF7C00F7CF3C00E7CF3C00E7CF3E01E7CF1E01C7CF1F03C7CF1F03C7CF0F0
387CF0F8787CF0F8787CF078707CF07CF07CF07CF07CF03CE07CF03CE07CF01FC07CF01FC07CF0
1FC07CF00F807C7007007C1E1A7D9925>I<7E001EFF001EFF001EFF801EFF801EF7C01EF3E01E
F3E01EF1F01EF1F01EF0F81EF0F81EF07C1EF07C1EF03E1EF03E1EF01F1EF01F1EF00F9EF00F9E
F007DEF003FEF003FEF001FEF001FE7000FE171A7D991E>I<00FF800003FFE0000FFFF8001FC1
FC003F007E003E003E007E003F007C001F00FC001F80FC001F80FC001F80FC001F80FC001F80FC
001F80FC001F80FC001F80FC001F80FC001F807E003F007E003F007F007F003F007E001FC1FC00
0FFFF80007FFF00000FF8000191A7E991E>I<7FFE00FFFF80FFFFC0FC0FE0FC03E0FC03F0FC03
F0FC03F0FC03F0FC03F0FC03F0FC03E0FC0FE0FFFFC0FFFF80FFFE00FC0000FC0000FC0000FC00
00FC0000FC0000FC0000FC0000FC00007C0000141A7D991A>I<7FFE00FFFF80FFFFC0FC07E0FC
03F0FC03F0FC03F0FC03F0FC03F0FC03F0FC07E0FFFFC0FFFF80FFFE00FC7E00FC3F00FC3F00FC
1F80FC1F80FC0FC0FC0FC0FC07E0FC07E0FC03F0FC03F07C01F0141A7D991A>82
D<07F8001FFE003FFF007FFF007C0F00F80200F80000F80000FC0000FF80007FF8007FFC003FFF
000FFF0007FF80007FC0000FC00007C00007C04007C0F007C0FC0F80FFFF807FFF001FFE0007F8
00121A7E9917>I<7FFFFFFFFFFFFFFFFFFFFFFF007E00007E00007E00007E00007E00007E0000
7E00007E00007E00007E00007E00007E00007E00007E00007E00007E00007E00007E00007E0000
7E00007E00003E00181A7F991B>I<7C007CFC007CFC007CFC007CFC007CFC007CFC007CFC007C
FC007CFC007CFC007CFC007CFC007CFC007CFC007CFC007CFC007CFC007CFC007CFC007C7C0078
7E00F83F01F01FFFE00FFFC001FF00161A7D991D>I<F000F80070F801FC00F0F801FC00F07C01
FC00E07C03FE01E07C03BE01E07C039E01E03E039E03C03E079F03C03E079F03C03E070F03C01F
0F0F07801F0F0F87801F0F0F87800F0E0787000F8E078F000F9E07CF000F9C07CF00079C03CE00
079C03CE0007DC03DE0007F803FE0003F801FC0003F801FC0003F801FC0001F000F800241A7F99
27>87 D<0FF03FFC3FFE381F201F001F00FF0FFF3F1F7C1FF81FF81FF81FFC7F7FFF3FDF1F1F10
117F9014>97 D<780000F80000F80000F80000F80000F80000F80000F80000F80000F8F800FBFE
00FFFE00FC1F00F81F80F80F80F80F80F80F80F80F80F80F80F80F80F80F80F81F00FC3F00FFFE
00FBFC0079F000111A7E9915>I<07F81FFE3FFE7C0E7C00F800F800F800F800F800F800F8007C
027C0E3FFE1FFE07F80F117F9012>I<000F80000F80000F80000F80000F80000F80000F80000F
80000F800FCF801FFF803FFF807E1F807C0F80F80F80F80F80F80F80F80F80F80F80F80F80F80F
807C0F807C1F803FFF801FEF800FCF80111A7F9915>I<07F01FFC3FFE7C1E780FF80FF80FFFFF
FFFFF800F800F80078007C033FFF1FFF03FC10117F9013>I<01FC07FC0FFC1F041F001F001F00
1F001F007FE0FFE0FFE01F001F001F001F001F001F001F001F001F001F001F001F001F000F000E
1A80990D>I<0FE1C03FFFC07FFDC07C7C00F83E00F83E00F83E00F83E00F83E007C7C007FFC00
3FF8006FE0006000007FFC007FFF003FFF807FFFC0F007C0F003C0F003C0F807C07FFF803FFF00
0FFC0012197F9015>I<7800F800F800F800F800F800F800F800F800F8FCF9FEFBFFFE1FFC1FF8
1FF81FF81FF81FF81FF81FF81FF81FF81FF81FF81F781F101A7E9915>I<7CFCFCFCFCFC000000
003C7C7C7C7C7C7C7C7C7C7C7C7C7C7C7C3C061B7F9A0A>I<7000F000F000F000F000F000F000
F000F000F07CF0F8F1F8F3F0F7E0FFC0FF80FF80FF80FFC0FBE0F1E0F1F0F0F8F07CF03C703C0E
1A7D9914>107 D<78F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F8F878051A7E990A>
I<78FC1F80F9FE3FC0FBFF7FE0FE1FC3E0FC1F83E0F81F03E0F81F03E0F81F03E0F81F03E0F81F
03E0F81F03E0F81F03E0F81F03E0F81F03E0F81F03E0F81F03E0780F01E01B117E9020>I<78FC
F9FEFBFFFE1FFC1FF81FF81FF81FF81FF81FF81FF81FF81FF81FF81FF81F781F10117E9015>I<
07F8001FFE003FFF007E1F807C0F80F807C0F807C0F807C0F807C0F807C0F807C0F807C07C0F80
7E1F803FFF001FFE0007F80012117F9015>I<78F800FBFE00FFFE00FC3F00F81F80F80F80F80F
80F80F80F80F80F80F80F80F80F80F80F81F00FC3F00FFFE00FBFC00F9F000F80000F80000F800
00F80000F80000F8000078000011187E9015>I<78C0FBC0FFC0FFC0FE00FC00F800F800F800F8
00F800F800F800F800F800F80078000A117E900E>114 D<1FC03FF07FF0F070F000F000FF007F
E03FF01FF003F80078C078F078FFF07FE01FC00D117F9010>I<1E003E003E003E003E007FE0FF
E0FFE03E003E003E003E003E003E003E003E003E003E003E203FF01FF00FC00C167F950F>I<78
1FF81FF81FF81FF81FF81FF81FF81FF81FF81FF81FF81FF81FF87FFFFF7F9F3F1F10117E9015>
I<E007F00FF00F781E781E781E3C3C3C3C3C3C1E781E781E780FF00FF00FF007E007E010117F90
13>I<E03E0380F07F0780F07F0780F07F078078F70F0078E78F0078E78F0078E78F003CE39E00
3DC3DE003DC3DE003DC3DE001FC1DC001FC1FC001F81FC001F81FC000F00F80019117F901C>I<
F00EF81E7C3C3E781EF80FF007E007C003C007E00FF01E701E783C3C781EF81FF00F10117F9013
>I<F007F80F780F781E3C1E3C1E3E3C1E3C1E3C0F380F78077007F003F003E001E001E001C001
C003C08780FF80FF00FC0010187F9013>I<3FFC7FFC7FFC00F801F001F003E007C007800F801F
003E003E007C00FFFCFFFCFFFC0E117F9012>I E /Ft 134[27 3[27 1[27
27 2[27 27 27 27 27 27 27 27 27 1[27 27 27 1[27 32[27 17[27
27 27 44[{}21 45.833332 /Courier rf /Fu 2 104 df<000F0038006000E001C001C001C0
01C001C001C001C001C001C001C001C001C001C001C001C0038007001E00F8001E000700038001
C001C001C001C001C001C001C001C001C001C001C001C001C001C001C000E000600038000F102D
7DA117>102 D<F8001E000700038001C001C001C001C001C001C001C001C001C001C001C001C0
01C001C001C000E000600038000F0038006000E001C001C001C001C001C001C001C001C001C001
C001C001C001C001C001C0038007001E00F800102D7DA117>I E /Fv 1
122 df<06000600060006000600060006000600FFF0FFF0060006000600060006000600060006
00060006000600060006000600060006000600060006000C1D7E9611>121
D E /Fw 134[25 1[38 26 28 15 19 18 1[27 25 27 40 13 25 1[13
27 25 15 22 28 20 1[23 7[30 3[36 28 24 2[28 1[38 43 28 1[15
1[38 3[35 32 10[23 1[23 23 2[23 1[23 2[15 11 44[{}40 45.833332
/Palatino-Roman rf /Fx 1 4 df<0300030003000300C30CE31C73381FE0078007801FE07338
E31CC30C03000300030003000E127D9215>3 D E /Fy 138[35 19 25 23
1[35 32 34 51 17 5[19 28 36 2[29 12[36 6[55 3[20 73[{}16 58.333336
/Palatino-Roman rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 300dpi
TeXDict begin

%%EndSetup
%%Page: 1 1
1 0 bop 373 41 a Fy(Monad)9 b(T)-5 b(ransformers)9 b(and)h(Modular)g(Interpr)
o(eters)1570 19 y Fx(\003)508 153 y Fw(Sheng)f(Liang)102 b(Paul)10
b(Hudak)101 b(Mark)11 b(Jones)1433 137 y Fv(y)816 253 y Fw(Y)l(ale)g
(University)635 309 y(Department)f(of)h(Computer)g(Science)692
366 y(New)f(Haven,)g(CT)h(06520-8285)482 422 y Fu(f)p Ft(liang,hudak)q(,j)q
(one)q(s-)q(mar)q(k)p Fu(g)p Ft(@c)q(s.)q(yal)q(e.)q(edu)-76
638 y Fs(Abstract)-76 720 y Fr(W)m(e)e(show)g(how)g(a)g(set)g(of)g
Fq(building)h(blocks)e Fr(can)g(be)g(used)g(to)i(construct)-76
761 y(pr)o(ogramming)f(language)e(interpr)o(eters,)i(and)g(pr)o(esent)g
(implemen-)-76 803 y(tations)j(of)g(such)e(building)g(blocks)g(capable)g(of)j
(supporting)e(many)-76 844 y(commonly)18 b(known)g(featur)o(es,)h(including)d
(simple)i(expr)o(essions,)-76 886 y(thr)o(ee)11 b(dif)o(fer)o(ent)g(function)
f(call)g(mechanisms)f(\(call-by-name,)h(call-)-76 928 y(by-value)15
b(and)g(lazy)f(evaluation\),)j(r)o(efer)o(ences)e(and)g(assignment,)-76
969 y(nondeterminism,)7 b(\256rst-class)g(continuations,)g(and)g(pr)o(ogram)h
(trac-)-76 1011 y(ing.)-20 1052 y(The)h(underlying)f(mechanism)g(of)j(our)e
(system)g(is)h Fq(monad)e(trans-)-76 1094 y(formers)p Fr(,)i(a)i(simple)f
(form)h(of)g(abstraction)e(for)i(intr)o(oducing)f(a)g(wide)-76
1135 y(range)i(of)i(computational)f(behaviors,)g(such)f(as)h(state,)h(I/O,)f
(con-)-76 1177 y(tinuations,)c(and)g(exceptions.)-20 1218 y(Our)j(work)h(is)f
(signi\256cant)e(in)i(the)h(following)g(r)o(espects.)24 b(First,)-76
1260 y(we)11 b(have)f(succeeded)e(in)j(designing)e(a)h(fully)g(modular)g
(interpr)o(eter)-76 1301 y(based)k(on)h(monad)g(transformers)g(that)f
(includes)g(featur)o(es)g(miss-)-76 1343 y(ing)i(fr)o(om)h(Steele's,)g
(Espinosa's,)h(and)d(W)m(adler)s('s)g(earlier)g(ef)o(forts.)-76
1384 y(Second,)d(we)h(have)f(found)g(new)g(ways)g(to)h(lift)f(monad)g
(operations)-76 1426 y(thr)o(ough)c(monad)g(transformers,)h(in)f(particular)f
(dif)o(\256cult)h(cases)f(not)-76 1467 y(achieved)j(in)h(Moggi's)h(original)e
(work.)18 b(Thir)o(d,)12 b(we)f(have)g(demon-)-76 1509 y(strated)18
b(that)g(interactions)e(between)i(featur)o(es)g(ar)o(e)g(r)o(e\257ected)f(in)
-76 1550 y(liftings)g(and)f(that)h(semantics)f(can)g(be)h(changed)e(by)i(r)o
(eor)o(dering)-76 1592 y(monad)h(transformers.)38 b(Finally)l(,)19
b(we)f(have)g(implemented)g(our)-76 1633 y(interpr)o(eter)13
b(in)f(Gofer)m(,)j(whose)d(constructor)g(classes)g(pr)o(ovide)h(just)-76
1675 y(the)c(added)f(power)i(over)f(Haskell's)f(type)i(classes)d(to)j(allow)f
(pr)o(ecise)-76 1716 y(and)k(convenient)g(expr)o(ession)h(of)g(our)g(ideas.)
23 b(This)13 b(implementa-)-76 1758 y(tion)k(includes)d(a)i(method)g(for)h
(constructing)d(extensible)h(unions)-76 1799 y(and)10 b(a)g(form)h(of)g
(subtyping)e(that)h(is)g(inter)o(esting)g(in)g(its)g(own)h(right.)-76
1902 y Fs(1)41 b(Intro)q(duction)10 b(and)f(Related)i(W)o(o)o(rk)-76
1984 y Fr(This)17 b(paper)h(discusses)d(how)j(to)g(construct)e(pr)o
(ogramming)h(lan-)-76 2025 y(guage)g(interpr)o(eters)g(out)h(of)h(modular)e
(components.)38 b(W)m(e)18 b(will)-76 2067 y(show)11 b(how)g(an)f(interpr)o
(eter)h(for)g(a)g(language)d(with)j(many)f(featur)o(es)-76
2108 y(can)i(be)g(composed)g(fr)o(om)i(building)c(blocks,)j(each)e
(implementing)p -76 2142 399 2 v -41 2163 a Fp(\003)-24 2176
y Fo(This)k(work)h(was)e(supported)i(by)f(the)f(Advanced)g(Resear)o(ch)h(Pr)o
(oject)g(Agency)-76 2209 y(and)21 b(the)g(Of)o(\256ce)g(of)f(Naval)i(Resear)o
(ch)g(under)e(Arpa)i(Or)o(der)g(8888,)g(Contract)-76 2242 y(N00014-92-)o(C-0)
o(15)o(3.)-39 2267 y Fp(y)-24 2279 y Fo(Curr)o(ent)g(addr)o(ess:)35
b(Department)22 b(of)e(Computer)g(Science,)k(University)f(of)-76
2312 y(Nottingham,)e(University)f(Park,)g(Nottingham)f(NG7)e(2RD,)i(England.)
36 b(Email:)-76 2346 y Fn(mpj@cs.n)q(ot)q(t.a)q(c.)q(uk)q Fo(.)-76
2430 y Fm(T)m(o)16 b(appear)e(in)h Fl(Confer)o(ence)h(Record)e(of)h(POPL)o
('95:)23 b(22nd)15 b(ACM)-76 2468 y(SIGPLAN-SIGACT)20 b(Symposium)d(on)g
(Principles)h(of)g(Pr)o(ogram-)-76 2505 y(ming)11 b(Languages,)f(San)h
(Francisco,)g(CA)p Fm(,)f(January)h(1995.)1020 638 y Fr(a)j(speci\256c)g
(featur)o(e.)27 b(The)14 b(interpr)o(eter)h(writer)f(is)g(able)g(to)h
(specify)1020 680 y(the)10 b(set)h(of)g(incorporated)f(featur)o(es)g(at)g(a)g
(very)g(high)f(level.)1076 721 y(The)16 b(motivation)g(for)h(building)d
(modular)h(interpr)o(eters)h(is)g(to)1020 763 y(isolate)e(the)g(semantics)g
(of)h(individual)d(pr)o(ogramming)i(language)1020 804 y(featur)o(es)6
b(for)h(the)g(purpose)g(of)g(better)f(understanding,)f(simplifying,)1020
846 y(and)13 b(implementing)h(the)g(featur)o(es)f(and)h(their)f
(interactions.)25 b(The)1020 887 y(lack)8 b(of)h(separability)f(of)h
(traditional)f(denotational)h(semantics)e([19])1020 929 y(has)16
b(long)h(been)f(r)o(ecognized.)34 b(Algebraic)15 b(appr)o(oaches)i(such)f(as)
1020 970 y(Mosses')j(action)e(semantics)g([16],)k(and)c(r)o(elated)h(ef)o
(forts)h(by)f(Lee)1020 1012 y([13],)12 b(W)m(and)f([23)o(],)i(Appel)f(&)f
(Jim)g([1)q(],)h(Kelsey)f(&)g(Hudak)f([11],)i(and)1020 1053
y(others,)g(attempt)g(to)h(solve)f(parts)f(of)i(this)e(pr)o(oblem,)i(but)e
(fall)g(short)1020 1101 y(in)f(several)f(crucial)f(ways.)1407
1085 y Fk(1)1076 1143 y Fr(A)18 b(gr)o(ound-br)o(eaking)d(attempt)j(to)g
(better)f(solve)h(the)f(overall)1020 1184 y(pr)o(oblem)12 b(began)e(with)h
(Moggi's)h([15])f(pr)o(oposal)i(to)f(use)e Fq(monads)g Fr(to)1020
1226 y(structur)o(e)j(denotational)h(semantics.)25 b(W)m(adler)13
b([21])i(popularized)1020 1267 y(Moggi's)i(ideas)f(in)h(the)g(functional)f
(pr)o(ogramming)g(community)1020 1309 y(by)11 b(showing)g(that)g(many)f(type)
i(constructors)d(\(such)i(as)f Fq(List)p Fr(\))i(wer)o(e)1020
1350 y(monads)18 b(and)f(how)i(monads)f(could)g(be)f(used)h(in)g(a)g(variety)
f(of)1020 1392 y(settings,)11 b(many)g(with)g(an)f(\252imperative\272)h(feel)
g(\(such)f(as)h(in)g(Peyton)1020 1433 y(Jones)g(&)g(W)m(adler)f([17]\).)16
b(W)m(adler)s('s)10 b(interpr)o(eter)h(design,)f(however)m(,)1020
1475 y(tr)o(eats)g(the)f(interpr)o(eter)h(monad)f(as)g(a)h(monolithic)f
(structur)o(e)f(which)1020 1516 y(has)k(to)i(be)f(r)o(econstructed)e(every)i
(time)g(a)f(new)h(featur)o(e)g(is)g(added.)1020 1558 y(Mor)o(e)i(r)o(ecently)
l(,)f(Steele)f([18])h(pr)o(oposed)i Fq(pseudomona)o(ds)11 b
Fr(as)i(a)h(way)1020 1599 y(to)g(compose)g(monads)e(and)h(thus)f(build)h(up)g
(an)f(interpr)o(eter)h(fr)o(om)1020 1641 y(smaller)6 b(parts,)i(but)f(he)g
(failed)g(to)h(pr)o(operly)g(incorporate)f(important)1020 1682
y(featur)o(es)15 b(such)f(as)i(an)f(envir)o(onment)g(and)g(stor)o(e,)i(and)e
(struggled)1020 1724 y(with)c(r)o(estrictions)g(in)f(the)h(Haskell)g([7])g
(type)h(system)f(when)f(trying)1020 1765 y(to)16 b(implement)f(his)g(ideas.)
29 b(In)15 b(fact,)h(pseudomonads)f(ar)o(e)g(r)o(eally)1020
1807 y(just)f(a)g(special)g(kind)g(of)i Fq(monad)d(transformer)p
Fr(,)h(\256rst)g(suggested)f(by)1020 1848 y(Moggi)f([15])g(as)f(a)h
(potential)g(way)f(to)h(leave)f(a)h(\252hole\272)f(in)g(a)h(monad)1020
1890 y(for)f(further)f(extension.)1076 1931 y(Returning)h(to)j(Moggi's)f
(original)f(ideas,)h(Espinosa)f([4])i(nicely)1020 1973 y(formulated)f(in)g
(Scheme)f(a)h(system)g(called)f Fq(Semantic)h(Lego)f Fr(\320)h(the)1020
2014 y(\256rst)i(modular)f(interpr)o(eter)h(based)f(on)i(monad)e
(transformers)h(\320)1020 2056 y(and)10 b(laid)g(out)g(the)h(issues)e(in)h
(lifting.)15 b(Espinosa's)c(work)f(r)o(eminded)1020 2097 y(the)18
b(pr)o(ogramming)h(language)d(community)i(\(including)f(us\))h(\320)1020
2139 y(who)e(had)e(become)h(distracted)e(by)i(the)g(use)f(of)i(monads)f(\320)
h(that)1020 2180 y(Moggi)11 b(himself,)g(r)o(esponsible)g(in)g(many)f(ways)g
(for)i(the)f(inter)o(est)g(in)1020 2222 y(monadic)h(pr)o(ogramming,)i(had)f
(actually)f(focussed)g(mor)o(e)i(on)f(the)1020 2263 y(importance)d(of)h
(monad)f(transformers.)1076 2305 y(W)m(e)j(begin)f(by)h(r)o(ealizing)e(the)i
(limitations)g(of)h(Moggi's)f(frame-)1020 2346 y(work)d(and)g(Espinosa's)g
(implementation,)g(in)f(particular)g(the)h(dif)o(\256-)1020
2388 y(culty)h(in)i(dealing)e(with)h(complicated)g(operations)h(such)e(as)h
Fq(callcc)p Fr(,)1020 2429 y(and)i(investigate)h(how)g(common)g(pr)o
(ogramming)g(language)e(fea-)p 1020 2463 V 1060 2488 a Fj(1)1072
2501 y Fo(V)m(ery)c(r)o(ecently)m(,)i(Cartwright)f(and)e(Felleisen)i([3)o(])e
(have)g(independently)i(pr)o(oposed)1020 2534 y(a)f(modular)g(semantics)h
(emphasizing)g(a)f Fi(dir)o(ect)h Fo(semantics)g(appr)o(oach,)g(which)g
(seems)1020 2567 y(somewhat)k(mor)o(e)h(complex)g(than)g(ours;)i(the)d(pr)o
(ecise)j(r)o(elationship)g(between)e(the)1020 2600 y(appr)o(oaches)c(is,)h
(however)n(,)f(not)g(yet)f(clear)n(.)p eop
%%Page: 2 2
2 1 bop -76 -74 2093 2 v -57 -19 a Fh(type)10 b Fq(T)l(erm)36
b Fg(=)h Fq(OR)11 b(T)l(ermA)37 b Fr(-)11 b(-)g(arithmetic)150
23 y Fg(\()44 b Fq(OR)11 b(T)l(ermF)43 b Fr(-)11 b(-)g(functions)150
64 y Fg(\()44 b Fq(OR)11 b(T)l(ermR)39 b Fr(-)11 b(-)g(assignment)150
106 y Fg(\()44 b Fq(OR)11 b(T)l(ermL)43 b Fr(-)11 b(-)g(lazy)e(evaluation)150
147 y Fg(\()44 b Fq(OR)11 b(T)l(ermT)41 b Fr(-)11 b(-)g(tracing)150
189 y Fg(\()44 b Fq(OR)11 b(T)l(ermC)39 b Fr(-)11 b(-)g(callcc)273
230 y Fq(T)l(ermN)36 b Fr(-)11 b(-)g(nondeterminism)209 272
y Fg(\)\)\)\)\))774 -19 y Fh(type)f Fq(InterpM)37 b Fg(=)g
Fq(StateT)10 b(Stor)o(e)75 b Fr(-)11 b(-)f(memory)h(cells)1032
23 y Fg(\()45 b Fq(EnvT)10 b(Env)105 b Fr(-)11 b(-)f(envir)o(onment)1032
64 y Fg(\()45 b Fq(ContT)10 b(Answer)36 b Fr(-)11 b(-)f(continuations)1032
106 y Fg(\()45 b Fq(StateT)10 b(String)56 b Fr(-)11 b(-)f(trace)g(output)1032
147 y Fg(\()45 b Fq(Err)o(orT)157 b Fr(-)11 b(-)f(err)o(or)h(r)o(eporting)
1092 189 y Fq(List)206 b Fr(-)11 b(-)f(multiple)g(r)o(esults)1092
230 y Fg(\)\)\)\))-57 356 y Fh(type)g Fq(V)m(alue)37 b Fg(=)g
Fq(OR)10 b(Int)h Fg(\()p Fq(OR)g(Fun)e Fg(\(\)\))706 452 y
Fr(Figur)o(e)g(1:)14 b(A)d(modular)e(interpr)o(eter)p -76 481
V -76 598 a(tur)o(es)15 b(interact)e(with)i(each)f(other)m(.)29
b(In)14 b(so)h(doing)f(we)h(ar)o(e)g(able)f(to)-76 639 y(expr)o(ess)8
b(mor)o(e)g(modularity)f(and)g(mor)o(e)h(language)e(featur)o(es)h(than)g(in)
-76 681 y(pr)o(evious)i(work,)h(solving)f(several)f(open)h(pr)o(oblems)g
(that)g(ar)o(ose)g(not)-76 722 y(only)g(in)h(Moggi's)g(work,)g(but)f(in)g
(Steele's)g(and)g(Espinosa's)g(as)g(well.)-76 764 y(Our)k(work)h(also)f(shar)
o(es)g(r)o(esults)g(with)g(Jones)h(and)f(Duponcheel's)-76 805
y([10])e(work)f(on)h(composing)f(monads.)-20 847 y(Independently)l(,)15
b(Espinosa)h([5])g(has)e(continued)g(working)h(on)-76 888 y(monad)9
b(transformers,)f(and)g(has)g(also)h(r)o(ecognized)e(the)i(limitations)-76
930 y(of)h(earlier)d(appr)o(oaches)i(and)f(pr)o(oposed)i(a)e(solution)h
(quite)f(dif)o(fer)o(ent)-76 971 y(fr)o(om)13 b(ours.)18 b(His)11
b(new)h(appr)o(oach)g(r)o(elies)f(on)g(a)h(notion)g(of)g(\252higher)o(-)-76
1013 y(or)o(der)s(\272)18 b(monads)f(\(called)h Fq(situated)f(monads)p
Fr(\))g(to)i(r)o(elate)f(dif)o(fer)o(ent)-76 1054 y(layers)13
b(of)i(monad)e(transformers,)i(and)e(he)h(has)f(investigated)g(the)-76
1096 y(semantic)k(implications)g(of)i(the)e(or)o(der)h(of)h(monad)e
(transformer)-76 1137 y(composition.)e(It)9 b(is)f(not)h(yet)f(clear)g(how)h
(his)f(new)g(appr)o(oach)h(r)o(elates)-76 1179 y(to)i(ours.)-20
1220 y(W)m(e)c(use)g Fq(Gofer)g Fr([8])h(syntax,)g(which)e(is)h(very)g
(similar)g(to)h(Haskell's,)-76 1262 y(thr)o(oughout)f(the)g(paper)m(.)14
b(W)m(e)7 b(choose)g(Gofer)h(over)f(Haskell)f(because)-76 1303
y(of)19 b(its)e(extended)h(type)g(system,)h(and)e(we)h(choose)g(a)f
(functional)-76 1345 y(language)e(over)i(mathematical)e(syntax)h(for)i(thr)o
(ee)f(r)o(easons:)27 b(\(1\))-76 1393 y(it)22 b(is)g(just)g(about)g(as)g
(concise)f(as)h(mathematical)e(syntax,)837 1377 y Fk(2)877
1393 y Fr(\(2\))-76 1434 y(it)g(emphasizes)f(the)h(fact)g(that)g(our)g(ideas)
g(ar)o(e)f(implementable)-76 1476 y(\(and)13 b(thus)f(have)h(been)f
(debugged!\),)i(and)e(\(3\))i(it)f(shows)g(how)h(the)-76 1517
y(r)o(elatively)19 b(new)g(idea)g(of)h Fq(constructor)e(classes)g
Fr([9])i(can)e(be)h(used)-76 1559 y(to)c(r)o(epr)o(esent)f(some)g(rather)f
(complex)h(typing)g(r)o(elationships.)25 b(Of)-76 1600 y(course,)f(monads)e
(can)e(be)i(expr)o(essed)g(in)f(a)h(variety)f(of)h(other)-76
1642 y(\(higher)o(-or)o(der\))17 b(pr)o(ogramming)e(languages,)h(in)f
(particular)g(SML)-76 1683 y([14],)20 b(whose)e(type)g(system)g(is)f(equally)
f(capable)h(of)i(expr)o(essing)-76 1725 y(some)f(of)i(our)d(ideas.)38
b(The)18 b(system)f(could)h(also)g(be)f(expr)o(essed)-76 1766
y(in)e(Scheme,)h(but)f(of)h(course)e(we)i(would)f(then)g(lose)g(the)h
(bene\256ts)-76 1808 y(of)i(str)o(ong)g(static)f(type-checking.)34
b(Our)17 b(Gofer)h(sour)o(ce)f(code)g(is)-76 1849 y(available)e(via)i
(anonymous)f(ftp)i(fr)o(om)g Fq(nebula.cs.yale.edu)d Fr(in)i(the)-76
1891 y(dir)o(ectory)10 b Fq(pub/yale-fp/modular-interpr)o(eter)p
Fr(.)-20 1932 y(T)m(o)g(appr)o(eciate)g(the)g(extent)h(of)g(our)f(r)o
(esults,)g(Figur)o(e)f(1)h(gives)g(the)-76 1974 y(high-level)i(de\256nition)g
(of)i(an)e(interpr)o(eter)m(,)i(which)e(is)g(constructed)-76
2015 y(in)i(a)f(modular)g(way)l(,)i(and)e(supports)h(arithmetic,)g(thr)o(ee)g
(dif)o(fer)o(ent)-76 2057 y(kinds)i(of)h(functions)f(\(call-by-name,)i
(call-by-value,)f(and)f(lazy\),)-76 2098 y(r)o(efer)o(ences)11
b(and)g(assignment,)f(nondeterminism,)h(\256rst-class)f(con-)-76
2140 y(tinuations,)k(and)f(tracing.)23 b(The)14 b(r)o(est)f(of)i(the)e(paper)
h(will)g(pr)o(ovide)-76 2181 y(the)g(details)f(of)i(how)f(the)g(type)g
(declarations)e(expand)i(into)g(a)g(full)-76 2223 y(interpr)o(eter)e(and)g
(how)h(each)e(component)i(is)f(built.)20 b(For)12 b(now)h(just)-76
2264 y(note)e(that)g Fq(OR)g Fr(is)g(equivalent)e(to)j(the)e(domain)h(sum)f
(operator)m(,)i(and)-76 2306 y Fq(T)l(erm)p Fr(,)f Fq(V)m(alue)h
Fr(and)f Fq(InterpM)g Fr(denote)h(the)f(sour)o(ce-level)g(terms,)h(run-)-76
2347 y(time)d(values,)f(and)f(supporting)i(featur)o(es)f(\(which)g(can)f(be)h
(r)o(egar)o(ded)-76 2389 y(as)15 b(the)g(run-time)f(system\),)i(r)o
(espectively)l(.)29 b Fq(Int)15 b Fr(and)g Fq(Fun)f Fr(ar)o(e)h(the)-76
2430 y(semantic)10 b(domains)g(for)h(integers)f(and)g(functions.)15
b Fq(T)l(ermA)p Fr(,)9 b Fq(T)l(ermF)p Fr(,)-76 2472 y(etc.)18
b(ar)o(e)f(the)g(abstract)f(syntax)h(for)h(arithmetic)f(terms,)i(function)p
-76 2505 399 2 v -36 2531 a Fj(2)-24 2543 y Fo(Although)9 b(\(for)g(lack)f
(of)h(space\))f(we)h(do)g(not)g(include)f(any)h(pr)o(oofs,)h(all)f
(constructs)-76 2576 y(\(monads,)k(monad)g(transformers)h(and)f(liftings\))i
(expr)o(essed)g(as)e(Gofer)h(code)f(have)-76 2610 y(been)d(veri\256ed)h(to)g
(satisfy)g(the)g(necessary)g(pr)o(operties)i(stated)e(in)g(this)h(paper)n(.)
1020 598 y Fr(expr)o(essions,)e(etc.)15 b(T)m(ype)9 b(constructors)g(such)f
(as)h Fq(StateT)h Fr(and)f Fq(ContT)1020 639 y Fr(ar)o(e)15
b Fq(monad)e(transformers)p Fr(;)i(they)g(add)f(featur)o(es,)i(and)e(ar)o(e)h
(used)f(to)1020 681 y(transform)g(the)f(monad)g Fq(List)h Fr(into)g(the)f
(monad)h Fq(InterpM)f Fr(used)g(by)1020 722 y(the)d(interpr)o(eter)m(.)1076
764 y(T)m(o)d(see)f(how)i Fq(T)l(erm)p Fr(,)e Fq(V)m(alue)p
Fr(,)i(and)e Fq(InterpM)g Fr(constitute)h(to)g(modular)1020
805 y(interpr)o(eters,)12 b(in)g(the)g(next)g(section)f(we)h(will)g(walk)g
(thr)o(ough)f(some)1020 847 y(simple)f(examples.)1020 948 y
Fs(2)41 b(An)10 b(Example)1020 1030 y Fr(A)j(conventional)e(interpr)o(eter)h
(maps,)i(say)l(,)e(a)g(term,)h(envir)o(onment,)1020 1071 y(and)f(stor)o(e,)j
(to)e(an)g(answer)m(.)22 b(In)12 b(contrast,)i(a)e(monadic)h(interpr)o(eter)
1020 1113 y(such)f(as)g(ours)h(maps)g(terms)g(to)g Fq(computations)p
Fr(,)g(wher)o(e)g(the)g(details)1020 1154 y(of)e(the)f(envir)o(onment,)h
(stor)o(e,)g(etc.)j(ar)o(e)d(\252hidden\272.)i(Speci\256cally:)1039
1217 y Fq(interp)36 b Fr(::)i Fq(T)l(erm)10 b Ff(!)h Fq(InterpM)f(V)m(alue)
1020 1282 y Fr(wher)o(e)20 b(\252)p Fq(InterpM)g(V)m(alue)p
Fr(\272)f(is)h(the)g(interpr)o(eter)g(monad)g(of)h(\256nal)1020
1323 y(answers.)1076 1365 y(What)e(makes)f(our)h(interpr)o(eter)f(modular)g
(is)h(that)f(all)h(thr)o(ee)1020 1406 y(components)11 b(above)f(\320)h(the)f
(term)h(type,)g(the)f(value)g(type,)h(and)e(the)1020 1448 y(monad)h(\320)h
(ar)o(e)f(con\256gurable.)j(T)m(o)d(illustrate,)g(if)h(we)f(initially)g(wish)
1020 1489 y(to)15 b(have)f(an)g(interpr)o(eter)h(for)g(a)f(small)g
(arithmetic)f(language,)h(we)1020 1531 y(can)9 b(\256ll)h(in)g(the)g
(de\256nitions)g(as)g(follows:)1039 1587 y Fh(type)g Fq(V)m(alue)79
b Fg(=)37 b Fq(OR)10 b(Int)h Fg(\(\))1039 1629 y Fh(type)f
Fq(T)l(erm)88 b Fg(=)37 b Fq(T)l(ermA)1039 1670 y Fh(type)10
b Fq(InterpM)37 b Fg(=)g Fq(Err)o(orT)9 b(Id)1020 1736 y Fr(The)15
b(\256rst)f(line)h(declar)o(es)f(the)h(answer)g(domain)f(to)i(be)f(the)g
(union)1020 1778 y(of)g(integers)e(and)h(the)f(unit)h(type)g(\(used)g(as)g
(the)g(base)f(type\).)27 b(The)1020 1819 y(second)13 b(line)g(de\256nes)f
(terms)h(as)g Fq(T)l(ermA)p Fr(,)g(the)h(abstract)e(syntax)h(for)1020
1861 y(arithmetic)f(operations.)22 b(The)12 b(\256nal)f(line)i(de\256nes)e
(the)i(interpr)o(eter)1020 1902 y(monad)h(as)h(a)f(transformation)g(of)i(the)
e(identify)h(monad)f Fq(Id)p Fr(.)28 b(The)1020 1944 y(monad)18
b(transformer)g Fq(Err)o(orT)f Fr(accounts)g(for)i(the)f(possibility)g(of)
1020 1985 y(err)o(ors;)11 b(in)e(this)i(case,)e(arithmetic)g(exceptions.)1076
2033 y(At)i(this)f(point)h(the)f(interpr)o(eter)g(behaves)f(like)h(a)g
(calculator:)1976 2017 y Fk(3)1039 2099 y Fe(>)21 b Fg(\(\()p
Fr(1)8 b Fg(+)g Fr(4)p Fg(\))g Ff(\003)h Fr(8)p Fg(\))1039
2140 y Fq(40)1039 2182 y Fe(>)21 b Fg(\()p Fr(3)p Fe(=)p Fr(0)p
Fg(\))1039 2223 y Fq(ERROR:)10 b(divide)g(by)g(0)1076 2289
y Fr(Now)h(if)h(we)e(wish)h(to)g(add)f(function)g(calls,)g(we)h(can)f(extend)
g(the)1020 2331 y(value)j(domain)g(with)h(function)f(types,)i(add)e(the)h
(abstract)e(syntax)1020 2372 y(for)17 b(function)f(calls)f(to)i(the)f(term)h
(type,)h(and)e(apply)g(the)h(monad)1020 2414 y(transformer)10
b Fq(EnvT)f Fr(to)i(intr)o(oduce)f(an)g(envir)o(onment)g Fq(Env)p
Fr(.)1039 2470 y Fh(type)g Fq(V)m(alue)79 b Fg(=)37 b Fq(OR)10
b(Int)h Fg(\()p Fq(OR)g(Fun)e Fg(\(\)\))1039 2512 y Fh(type)h
Fq(T)l(erm)88 b Fg(=)37 b Fq(OR)10 b(T)l(ermF)f(T)l(ermA)1039
2553 y Fh(type)h Fq(InterpM)37 b Fg(=)g Fq(EnvT)10 b(Env)f
Fg(\()p Fq(Err)o(orT)g(Id)p Fg(\))p 1020 2585 V 1060 2610 a
Fj(3)1072 2622 y Fo(For)i(lack)g(of)f(space,)g(we)h(omit)g(the)f(details)i
(of)e(parsing)h(and)f(printing.)961 2747 y Fr(2)p eop
%%Page: 3 3
3 2 bop -76 -34 a Fr(Her)o(e)10 b(is)h(a)f(test)g(run:)-57
26 y Fe(>)21 b Fg(\(\()p Ff(n)p Fe(x:)p Fg(\()p Fe(x)7 b Fg(+)i
Fr(4)p Fg(\)\))h Fr(7)p Fg(\))-57 67 y Fq(11)-57 109 y Fe(>)21
b Fg(\()p Fe(x)8 b Fg(+)g Fr(4)p Fg(\))-57 151 y Fq(ERROR:)i(unbound)f
(variable:)14 b(x)-76 221 y Fr(By)e(adding)e(other)i(featur)o(es,)g(we)g(can)
f(arrive)g(at)g(\(and)h(go)g(beyond\))-76 262 y(the)j(interpr)o(eter)h(in)f
(Figur)o(e)f(1.)30 b(In)15 b(the)g(pr)o(ocess)h(of)g(adding)f(new)-76
304 y(sour)o(ce-level)d(terms,)h(whenever)e(a)h(new)g(value)g(domain)f
(\(such)h(as)-76 345 y(Boolean\))g(is)g(needed,)g(we)g(extend)g(the)g
Fq(V)m(alue)f Fr(type,)i(and)f(to)g(add)g(a)-76 387 y(new)i(semantic)e
(featur)o(e)i(\(such)e(as)i(a)f(stor)o(e)h(or)g(continuation\),)g(we)-76
428 y(apply)d(the)f(corr)o(esponding)g(monad)g(transformer)m(.)-76
526 y Fs(Why)j(monads?)37 b Fr(In)12 b(a)h(sense,)h(monads)f(ar)o(e)g
(nothing)f(mor)o(e)i(than)-76 567 y(a)g(good)h(example)f(of)i(data)d
(abstraction.)26 b(But)14 b(they)g(just)f(happen)-76 609 y(to)h(be)f(a)h
(particularly)d Fq(good)h Fr(abstraction,)h(and)g(by)g(using)f(them)i(in)-76
650 y(a)k(disciplined)e(\(and)i(appr)o(opriate\))h(way)l(,)h(we)e(generally)e
(obtain)-76 692 y(well-structur)o(ed,)8 b(modular)g(pr)o(ograms.)15
b(In)8 b(our)h(application,)h(they)-76 733 y(ar)o(e)d(surprisingly)f(useful)h
(for)h(individually)d(capturing)h(the)i(essence)-76 775 y(of)16
b(a)e(wide)h(range)e(of)j(pr)o(ogramming)e(language)f(featur)o(es,)j(while)
-76 817 y(abstracting)11 b(away)g(fr)o(om)j(low-level)f(details.)20
b(Then)11 b(with)i(monad)-76 858 y Fq(transformers)k Fr(we)j(can)f(put)h(the)
g(individual)e(featur)o(es)h(together)m(,)-76 900 y(piece-by-piece)i(in)g
(dif)o(fer)o(ent)i(or)o(ders,)h(to)e(cr)o(eate)f(full-featur)o(ed)-76
941 y(interpr)o(eters.)-76 1043 y Fs(3)41 b(The)11 b(Constructo)o(r)e(Class)g
(System)-76 1125 y Fr(For)20 b(r)o(eaders)f(not)h(familiar)f(with)h(the)f
(Gofer)h(type)g(system)f(\(in)-76 1166 y(particular)m(,)f(constructor)d
(classes)h([9]\),)k(this)d(section)f(pr)o(ovides)i(a)-76 1208
y(motivating)10 b(example.)-20 1249 y(Constructor)j(classes)e(support)j
(abstraction)e(of)i(common)f(fea-)-76 1291 y(tur)o(es)h(among)f(type)i
(constructors.)24 b(Haskell,)14 b(for)h(example,)g(pr)o(o-)-76
1333 y(vides)c(the)g(standar)o(d)g Fq(map)f Fr(function)h(to)h(apply)g(a)f
(function)g(to)h(each)-76 1374 y(element)e(of)h(a)f(given)g(list:)-57
1441 y Fq(map)37 b Fr(::)h Fg(\()p Fe(a)11 b Ff(!)g Fe(b)p
Fg(\))g Ff(!)g Fg([)p Fe(a)p Fg(])f Ff(!)h Fg([)p Fe(b)p Fg(])-76
1510 y Fr(Meanwhile,)e(we)g(can)f(de\256ne)f(similar)h(functions)g(for)i(a)e
(wide)h(range)-76 1552 y(of)i(other)g(datatypes.)j(For)c(example:)-57
1622 y Fh(data)g Fq(T)l(r)o(ee)f Fe(a)38 b Fg(=)f Fq(Leaf)9
b Fe(a)165 1663 y Ff(j)47 b Fq(Node)9 b Fg(\()p Fq(T)l(r)o(ee)g
Fe(a)p Fg(\))i(\()p Fq(T)l(r)o(ee)d Fe(a)p Fg(\))-57 1743 y
Fq(mapT)l(r)o(ee)35 b Fr(::)j Fg(\()p Fe(a)11 b Ff(!)g Fe(b)p
Fg(\))g Ff(!)g Fq(T)l(r)o(ee)e Fe(a)i Ff(!)g Fq(T)l(r)o(ee)e
Fe(b)-57 1853 y Fq(mapT)l(r)o(ee)f Fe(f)14 b Fg(\()p Fq(Leaf)c
Fe(x)p Fg(\))73 b(=)37 b Fq(Leaf)9 b Fg(\()p Fe(f)14 b(x)p
Fg(\))-57 1894 y Fq(mapT)l(r)o(ee)8 b Fe(f)14 b Fg(\()p Fq(Node)9
b Fe(l)j(r)q Fg(\))38 b(=)f Fq(Node)9 b Fg(\()p Fq(mapT)l(r)o(ee)f
Fe(f)14 b(l)q Fg(\))d(\()p Fq(mapT)l(r)o(ee)d Fe(f)14 b(r)q
Fg(\))-76 1972 y Fr(The)g Fq(mapT)l(r)o(ee)f Fr(function)h(has)g(similar)f
(type)i(and)f(functionality)g(to)-76 2013 y(those)f(of)h Fq(map)p
Fr(.)23 b(W)n(ith)13 b(this)g(in)f(mind,)i(it)f(seems)f(a)h(shame)f(that)h
(we)-76 2055 y(have)6 b(to)h(use)e(dif)o(fer)o(ent)i(names)f(for)h(each)e(of)
i(these)f(variants.)12 b(Indeed,)-76 2096 y(Gofer)f(allows)f(type)h
(variables)e(to)j(stand)e(for)h Fq(type)f(constructors)p Fr(,)f(on)-76
2138 y(which)14 b(the)g(Haskell)f(type)i(class)f(system)f(has)h(been)g
(extended)g(to)-76 2179 y(support)9 b(overloading.)14 b(T)m(o)8
b(solve)h(the)g(pr)o(oblem)g(with)f Fq(map)p Fr(,)h(we)f(can)-76
2221 y(intr)o(oduce)14 b(a)h(new)f(constructor)g(class)g Fq(Functor)g
Fr(\(in)h(a)f(categorical)-76 2262 y(sense\):)-57 2330 y Fh(class)9
b Fq(Functor)h Fe(f)k Fh(where)-20 2372 y Fq(map)21 b Fr(::)g
Fg(\()p Fe(a)11 b Ff(!)g Fe(b)p Fg(\))g Ff(!)g Fe(f)j(a)e Ff(!)f
Fe(f)j(b)-76 2442 y Fr(Now)f(the)g(standar)o(d)e(list)i(\()p
Fq(List)p Fr(\))h(and)e(the)g(user)o(-de\256ned)f(type)i(con-)-76
2483 y(structor)c Fq(T)l(r)o(ee)g Fr(ar)o(e)h(both)h(instances)e(of)i
Fq(Functor)p Fr(:)-57 2544 y Fh(instance)e Fq(Functor)h(List)g
Fh(where)-20 2585 y Fq(map)g Fe(f)k Fg([)c(])121 b(=)37 b([)10
b(])-20 2627 y Fq(map)g Fe(f)k Fg(\()p Fe(x)c Fr(:)h Fq(xs)p
Fg(\))37 b(=)g Fe(f)14 b(x)21 b Fr(:)g Fq(map)10 b Fe(f)k Fq(xs)1039
-47 y Fh(instance)9 b Fq(Functor)h(T)l(r)o(ee)f Fh(where)1076
-5 y Fq(map)h Fe(f)k Fg(\()p Fq(Leaf)9 b Fe(x)p Fg(\))73 b(=)37
b Fq(Leaf)10 b Fg(\()p Fe(f)k(x)p Fg(\))1076 36 y Fq(map)c
Fe(f)k Fg(\()p Fq(Node)9 b Fe(l)j(r)q Fg(\))37 b(=)g Fq(Node)10
b Fg(\()p Fq(map)f Fe(f)14 b(l)q Fg(\))d(\()p Fq(map)e Fe(f)15
b(r)q Fg(\))1076 115 y Fr(In)7 b(building)e(modular)i(interpr)o(eters,)h(we)f
(will)g(\256nd)g(constructor)1020 157 y(classes)j(extr)o(emely)h(useful)g
(for)h(dealing)e(with)h(multiple)g(instances)1020 198 y(of)21
b(monads)e(and)h(monad)f(transformers)g(\(which)h(ar)o(e)g(all)f(type)1020
240 y(constructors\).)1020 342 y Fs(4)41 b(Extensible)9 b(Union)g(T)m(yp)q
(es)1020 424 y Fr(W)m(e)i(begin)f(with)g(a)h(discussion)e(of)j(a)f(key)f
(idea)g(in)h(our)f(framework:)1020 465 y(how)j(values)e(and)h(terms)g(may)g
(be)g(expr)o(essed)g(as)g Fq(extensible)g(union)1020 507 y(types)p
Fr(.)i(\(This)c(facility)g(has)f(nothing)h(to)h(do)g(with)f(monads.\))1076
548 y(The)22 b(disjoint)g(union)g(of)i(two)f(types)g(is)f(captur)o(ed)g(by)g
(the)1020 590 y(datatype)10 b Fq(OR)p Fr(.)1039 658 y Fh(data)g
Fq(OR)g Fe(a)h(b)38 b Fg(=)f Fe(L)10 b(a)h Ff(j)g Fe(R)f(b)1020
728 y Fr(wher)o(e)e Fq(L)f Fr(and)h Fq(R)g Fr(ar)o(e)f(used)g(to)i(perform)f
(the)g(conventional)f(injection)1020 770 y(of)17 b(a)f(summand)f(type)i(into)
f(the)g(union;)j(conventional)d(pattern-)1020 811 y(matching)d(is)i(used)f
(for)h(pr)o(ojection.)29 b(However)m(,)17 b(such)c(injections)1020
853 y(and)i(pr)o(ojections)h(only)f(work)g(if)h(we)g(know)g(the)f(exact)g
(structur)o(e)1020 894 y(of)21 b(the)f(union;)25 b(in)20 b(particular)m(,)i
(an)d(extensible)h(union)f(may)h(be)1020 936 y(arbitrarily)6
b(nested,)i(and)g(we)g(would)g(like)f(a)h Fq(single)f Fr(pair)h(of)h
(injection)1020 977 y(and)h(pr)o(ojection)g(functions)g(to)h(work)g(on)f(all)
g(such)f(constructions.)1076 1019 y(T)m(o)17 b(achieve)f(this,)j(we)f
(de\256ne)e(a)h(type)h(class)e(to)i(captur)o(e)e(the)1020 1060
y(summand/union)c(type)i(r)o(elationship,)h(which)f(we)g(r)o(efer)g(to)h(as)f
(a)1020 1102 y(\252subtype\272)9 b(r)o(elationship:)1039 1181
y Fh(class)g Fq(SubT)m(ype)f(sub)i(sup)g Fh(where)1095 1222
y Fq(inj)40 b Fr(::)e Fq(sub)10 b Ff(!)h Fq(sup)186 b Fr(-)11
b(-)g(injection)1095 1264 y Fq(prj)37 b Fr(::)h Fq(sup)9 b
Ff(!)i Fq(Maybe)f(sub)74 b Fr(-)11 b(-)g(pr)o(ojection)1039
1345 y Fh(data)f Fq(Maybe)f Fe(a)22 b Fg(=)f Fq(Just)10 b Fe(a)h
Ff(j)g Fq(Nothing)1020 1422 y Fr(The)g Fq(Maybe)g Fr(datatype)h(is)f(used)g
(because)f(the)i(pr)o(ojection)g(function)1020 1464 y(may)17
b(fail.)37 b(W)m(e)17 b(can)g(now)g(expr)o(ess)h(the)g(r)o(elationships)f
(that)g(we)1020 1505 y(desir)o(e:)1039 1567 y Fh(instance)9
b Fq(SubT)m(ype)g Fe(a)h Fg(\()p Fq(OR)h Fe(a)f(b)p Fg(\))h
Fh(where)1095 1608 y Fq(inj)138 b Fg(=)37 b Fe(L)1095 1650
y Fq(prj)10 b Fg(\()p Fe(L)g(x)p Fg(\))37 b(=)g Fq(Just)11
b Fe(x)1095 1691 y Fq(prj)p 1151 1691 12 2 v 135 w Fg(=)37
b Fq(Nothing)1039 1772 y Fh(instance)9 b Fq(SubT)m(ype)g Fe(a)h(b)i
Ff(\))f Fq(SubT)m(ype)d Fe(a)j Fg(\()p Fq(OR)f Fe(c)g(b)p Fg(\))h
Fh(where)1095 1814 y Fq(inj)140 b Fg(=)37 b Fe(R)9 b Ff(\001)f
Fq(inj)1095 1855 y(prj)i Fg(\()p Fe(R)g(a)p Fg(\))38 b(=)f
Fq(prj)10 b Fe(a)1095 1897 y Fq(prj)p 1151 1897 V 137 w Fg(=)37
b Fq(Nothing)1076 1976 y Fr(Now)17 b(we)g(can)f(see,)j(for)e(example,)i(how)e
(the)g Fq(V)m(alue)f Fr(domain)1020 2017 y(used)j(in)h(the)g(interpr)o(eter)f
(example)h(given)g(earlier)e(is)i(actually)1020 2059 y(constructed:)1039
2120 y Fh(type)10 b Fq(V)m(alue)37 b Fg(=)g Fq(OR)10 b(Int)h
Fg(\()p Fq(OR)g(Fun)e Fg(\(\)\))1039 2162 y Fh(type)h Fq(Fun)61
b Fg(=)37 b Fq(InterpM)10 b(V)m(alue)g Ff(!)h Fq(InterpM)f(V)m(alue)1020
2233 y Fr(W)n(ith)d(these)f(de\256nitions)g(the)g(Gofer)h(type)g(system)f
(will)h(infer)f(that)h Fq(Int)1020 2274 y Fr(and)k Fq(Function)g
Fr(ar)o(e)g(both)g(\252subtypes\272)f(of)i Fq(V)m(alue)p Fr(,)f(and)g(the)g
(coer)o(cion)1020 2322 y(functions)f Fq(inj)h Fr(and)e Fq(prj)h
Fr(will)g(be)g(generated)f(automatically)l(.)1895 2306 y Fk(4)1922
2322 y Fr(\(Note)1020 2364 y(that)16 b(the)f(r)o(epr)o(esentation)h(of)g(a)g
(function)f(is)h(quite)f(general)f(\320)i(it)1020 2405 y(maps)i
Fq(computations)f Fr(to)i Fq(computations)p Fr(.)37 b(As)18
b(will)f(be)h(seen,)i(this)1020 2447 y(generality)7 b(allows)i(us)f(to)h
(model)g(both)g(call-by-name)e(and)h(call-by-)1020 2488 y(value)i
(semantics.\))p 1020 2518 399 2 v 1060 2543 a Fj(4)1072 2556
y Fo(W)m(e)18 b(should)f(point)h(out)f(her)o(e)h(that)f(most)h(of)e(the)i
(typing)h(pr)o(oblems)f(Steele)1020 2589 y(encounter)o(ed)h(disappear)g(with)
g(the)g(use)f(of)g(our)h(extensible)h(union)e(types;)24 b(in)1020
2622 y(particular)n(,)12 b(ther)o(e)f(is)h(no)e(need)g(for)g(Steele's)i
(\252towers\272)e(of)g(datatypes.)961 2747 y Fr(3)p eop
%%Page: 4 4
4 3 bop -76 -34 a Fs(5)41 b(The)11 b(Interp)o(reter)f(Building)f(Blo)q(cks)
-76 47 y Fr(As)23 b(in)f(the)g(example)h(of)h(Section)e(2,)j(the)e
Fq(T)l(erm)e Fr(type)i(is)g(also)-76 89 y(constructed)12 b(as)h(an)h
(extensible)e(union)h(\(of)i(subterm)e(types\).)26 b(W)m(e)-76
131 y(de\256ne)14 b(additionally)f(a)h(class)f Fq(InterpC)h
Fr(to)h(characterize)c(the)k(term)-76 172 y(types)c(that)f(we)g(wish)g(to)h
(interpr)o(et:)-57 246 y Fh(class)e Fq(InterpC)h Fe(t)g Fh(where)-1
287 y Fq(interp)37 b Fr(::)h Fe(t)10 b Ff(!)h Fq(InterpM)f(V)m(alue)-76
362 y Fr(The)16 b(behavior)f(of)i Fq(interp)f Fr(on)g(unions)f(of)i(terms)f
(is)g(given)g(in)g(the)-76 403 y(obvious)10 b(way:)-57 477
y Fh(instance)f Fg(\()p Fq(InterpC)h Fe(t)252 481 y Fk(1)266
477 y Fe(;)17 b Fq(InterpC)9 b Fe(t)436 481 y Fk(2)451 477
y Fg(\))h Ff(\))316 518 y Fq(InterpC)g Fg(\()p Fq(OR)g Fe(t)538
522 y Fk(1)563 518 y Fe(t)577 522 y Fk(2)592 518 y Fg(\))g
Fh(where)-1 560 y Fq(interp)g Fg(\()p Fe(L)g(t)p Fg(\))40 b(=)e
Fq(interp)9 b Fe(t)-1 601 y Fq(interp)h Fg(\()p Fe(R)g(t)p
Fg(\))37 b(=)h Fq(interp)9 b Fe(t)-76 675 y Fr(The)f Fq(interp)h
Fr(function)f(mentioned)g(in)h(the)f(opening)h(example)g(is)f(just)-76
717 y(the)i(method)h(associated)e(with)h(the)g(top-level)i(type)f
Fq(T)l(erm)p Fr(.)-20 758 y(In)g(the)h(r)o(emainder)e(of)j(this)e(section)g
(we)h(de\256ne)f(several)g(r)o(epr)o(e-)-76 800 y(sentative)h
Fq(interpr)o(eter)e(building)j(blocks)p Fr(,)f(each)f(an)h(instance)f(of)i
(class)-76 841 y Fq(InterpC)g Fr(and)h(written)f(in)h(a)g(monadic)f(style.)25
b(W)m(e)14 b(will)g(mor)o(e)g(for)o(-)-76 883 y(mally)i(de\256ne)g(monads)h
(later)m(,)h(but)f(for)g(now)h(we)f(note)g(that)g(the)-76 924
y(interpr)o(eter)c(monad)f Fq(InterpM)h Fr(comes)g(equipped)f(with)h(two)h
(basic)-76 966 y(operations:)-57 1039 y Fq(unit)40 b Fr(::)e
Fe(a)11 b Ff(!)g Fq(InterpM)f Fe(a)-57 1081 y Fq(bind)37 b
Fr(::)h Fq(InterpM)10 b Fe(a)h Ff(!)g Fg(\()p Fe(a)g Ff(!)g
Fq(InterpM)g Fe(b)p Fg(\))g Ff(!)g Fq(InterpM)f Fe(b)-76 1154
y Fr(Intuitively)l(,)21 b Fq(InterpM)e(a)g Fr(denotes)g(a)g(computation)h(r)o
(eturning)e(a)-76 1196 y(r)o(esult)e(of)h(type)g Fq(a)p Fr(.)32
b(\252)p Fq(Unit)17 b(x)p Fr(\272)e(is)h(a)g(null)g(computation)g(that)g
(just)-76 1237 y(r)o(eturns)c Fq(x)g Fr(as)g(r)o(esult,)h(wher)o(eas)f(\252)p
Fq(m)h(`bind`)g(k)p Fr(\272)f(runs)f Fq(m)i Fr(and)f(passes)-76
1279 y(the)g(r)o(esult)g(to)h(the)f(r)o(est)g(of)h(the)f(computation)h
Fq(k)p Fr(.)20 b(As)12 b(will)g(be)g(seen,)-76 1320 y(besides)j
Fq(unit)i Fr(and)f Fq(bind)p Fr(,)i(each)d(interpr)o(eter)h(building)f(block)
g(has)-76 1362 y(several)10 b(other)g(operations)h(that)f(ar)o(e)g
(speci\256c)f(to)i(its)f(purpose.)-76 1460 y Fs(5.1)41 b(The)11
b(Arithmetic)f(Building)f(Blo)q(ck)-76 1528 y Fr(Our)h(\(very)h(tiny\))f
(arithmetic)f(sublanguage)e(is)j(given)g(by:)-57 1602 y Fh(data)g
Fq(T)l(ermA)36 b Fg(=)h Fq(Num)10 b(Int)177 1643 y Ff(j)46
b Fq(Add)10 b(T)l(erm)f(T)l(erm)-76 1717 y Fr(whose)i(monadic)e(interpr)o
(etation)h(is)g(given)g(by:)-57 1790 y Fh(instance)f Fq(InterpC)h(T)l(ermA)f
Fh(where)-1 1832 y Fq(interp)h Fg(\()p Fq(Num)g Fe(x)p Fg(\))53
b(=)37 b Fq(unitInj)12 b Fe(x)-1 1873 y Fq(interp)e Fg(\()p
Fq(Add)f Fe(x)h(y)q Fg(\))38 b(=)f Fq(interp)10 b Fe(x)g Fr(`)p
Fq(bindPrj)p Fr(`)h Ff(n)p Fe(i)g Ff(!)362 1915 y Fq(interp)f
Fe(y)i Fr(`)p Fq(bindPrj)p Fr(`)f Ff(n)p Fe(j)h Ff(!)362 1956
y Fq(unitInj)g Fg(\(\()p Fe(i)c Fg(+)g Fe(j)r Fg(\))j Fr(::)g
Fq(Int)q Fg(\))-57 2040 y Fq(unitInj)142 b Fg(=)37 b Fq(unit)9
b Ff(\001)f Fq(inj)-57 2082 y Fe(m)i Fr(`)p Fq(bindPrj)p Fr(`)h
Fe(k)39 b Fg(=)55 2123 y Fe(m)10 b Fr(`)p Fq(bind)q Fr(`)g
Ff(n)p Fe(a)i Ff(!)55 2165 y Fh(case)d Fg(\()p Fq(prj)h Fe(a)p
Fg(\))g Fh(of)130 2206 y Fq(Just)g Fe(x)72 b Ff(!)37 b Fe(k)12
b(x)130 2248 y Fq(Nothing)37 b Ff(!)g Fq(err)9 b("run-time)h(type)g(err)o
(or")-57 2332 y(err)19 b Fr(::)j Fq(String)10 b Ff(!)i Fq(InterpM)e
Fe(a)112 b Fr(-)11 b(-)g(de\256ned)e(later)-76 2412 y(Note)g(the)f(simple)g
(use)g(of)h Fq(inj)g Fr(and)e Fq(prj)h Fr(to)h(inject/pr)o(oject)e(the)h
(integer)-76 2454 y(r)o(esult)i(into/out)g(of)g(the)g Fq(V)m(alue)g
Fr(domain,)g(r)o(egar)o(dless)f(of)i(how)f Fq(V)m(alue)-76
2495 y Fr(is)16 b(eventually)f(de\256ned)g(\()p Fq(unitInj)j
Fr(and)e Fq(bindPrj)g Fr(make)g(this)g(a)g(tad)-76 2537 y(easier)m(,)10
b(and)f(will)g(be)g(used)g(later)g(as)h(well\).)k Fq(Err)9
b Fr(is)h(an)f(operation)h(for)-76 2578 y(r)o(eporting)h(err)o(ors)f(to)h(be)
f(de\256ned)f(later)m(.)1020 -34 y Fs(5.2)41 b(The)10 b(F)o(unction)g
(Building)f(Blo)q(ck)1020 33 y Fr(Our)h(\252function\272)f(sublanguage)f(is)i
(given)g(by:)1039 103 y Fh(data)g Fq(T)l(ermF)36 b Fg(=)h Fq(V)m(ar)10
b(Name)1266 144 y Ff(j)47 b Fq(LambdaN)9 b(Name)h(T)l(erm)74
b Fr(-)10 b(-)h(cbn)1266 186 y Ff(j)47 b Fq(LambdaV)9 b(Name)h(T)l(erm)76
b Fr(-)10 b(-)h(cbv)1266 227 y Ff(j)47 b Fq(App)10 b(T)l(erm)f(T)l(erm)1020
296 y Fr(which)14 b(supports)h(two)h(kinds)e(of)i(abstractions,)f(one)f(for)i
(call-by-)1020 338 y(name,)10 b(the)g(other)h(for)g(call-by-value.)1076
379 y(W)m(e)k(assume)f(a)h(type)g Fq(Env)g Fr(of)h(envir)o(onments)f(that)f
(associates)1020 421 y(variable)k(names)g(with)h(computations)h(\(corr)o
(esponding)f(to)g(the)1020 462 y(\252closur)o(e\272)12 b(mode)h(of)h
(evaluation)e([2]\),)j(and)e(that)f(has)h(two)h(opera-)1020
504 y(tions:)1039 563 y Fq(lookupEnv)53 b Fr(::)44 b Fq(Name)10
b Ff(!)h Fq(Env)f Ff(!)h Fq(Maybe)e Fg(\()p Fq(InterpM)h(V)m(alue)p
Fg(\))1039 604 y Fq(extendEnv)53 b Fr(::)44 b Fg(\()p Fq(Name)o
Fe(;)16 b Fq(InterpM)10 b(V)m(alue)p Fg(\))g Ff(!)h Fq(Env)f
Ff(!)h Fq(Env)1039 646 y Fh(type)f Fq(Name)36 b Fg(=)i Fq(String)1020
715 y Fr(In)15 b(addition,)j(we)e(will)f(de\256ne)g(later)h(two)h(monadic)e
(operations,)1020 756 y Fq(rdEnv)e Fr(and)h Fq(inEnv)p Fr(,)i(that)f(r)o
(eturn)f(the)g(curr)o(ent)g(envir)o(onment)g(and)1020 798 y(perform)9
b(a)f(computation)g(in)g(a)f(given)h(envir)o(onment,)h(r)o(espectively:)1039
867 y Fq(rdEnv)36 b Fr(::)i Fq(InterpM)10 b(Env)1039 908 y(inEnv)39
b Fr(::)f Fq(Env)10 b Ff(!)h Fq(InterpM)f Fe(a)h Ff(!)g Fq(InterpM)f
Fe(a)1020 977 y Fr(The)18 b(interpr)o(etation)g(of)h(the)f(applicative)g
(sublanguage)d(is)j(then)1020 1019 y(given)10 b(in)g(Figur)o(e)f(2.)1076
1060 y(The)16 b(dif)o(fer)o(ence)g(between)g(call-by-value)f(and)h
(call-by-name)1020 1102 y(is)11 b(clear:)16 b(the)c(former)f(r)o(educes)f
(the)i(ar)o(gument)e(befor)o(e)i(evaluating)1020 1143 y(the)e(function)g
(body)l(,)g(wher)o(eas)g(the)g(latter)g(does)h(not.)k(In)10
b(a)g(function)1020 1185 y(application,)h(the)g(function)g(itself)g(is)g
(evaluated)e(\256rst,)i(and)f Fq(bindPrj)1020 1226 y Fr(checks)16
b(if)i(it)g(is)f(indeed)g(a)g(function.)36 b(The)17 b(computation)h(of)g
Fe(e)2002 1230 y Fk(2)1020 1268 y Fr(is)h(packaged)f(up)h(with)h(the)f(curr)o
(ent)f(envir)o(onment)h(to)h(form)g(a)1020 1309 y(closur)o(e,)13
b(which)g(is)f(then)h(passed)g(to)g Fe(f)t Fr(.)23 b(W)m(e)13
b(could)f(just)h(as)f(easily)1020 1351 y(r)o(ealize)f(dynamic)f(scoping)h(by)
g(passing)g(not)h(the)g(closur)o(e,)f(but)g(the)1020 1392 y(computation)f(of)
i Fe(e)1303 1396 y Fk(2)1327 1392 y Fr(alone.)1076 1434 y(When)d(applying)g
(a)g(call-by-value)e(function,)j(we)f(build)f(a)h(com-)1020
1475 y(putation)15 b(which)f(gets)h(evaluated)f(immediately)f(upon)i
(entering)1020 1517 y(the)d(function)f(body)l(.)18 b(Although)11
b(semantically)f(corr)o(ect,)i(this)f(does)1020 1558 y(not)j(corr)o(espond)f
(to)h(an)f(ef)o(\256cient)g(implementation.)23 b(In)13 b(practice,)1020
1600 y(however)m(,)h(we)e(expect)h(that)f(the)h(pr)o(esence)f(of)h(some)g
(kind)f(of)h(type)1020 1641 y(information)e(or)g(a)f(special)h(syntax)f(for)h
(call-by-value)f(application)1020 1683 y(will)g(enable)f(us)h(to)h(optimize)g
(away)e(this)h(over)o(head.)1076 1724 y(W)m(e)16 b(note)g(that)f(Steele)h
(felt)g(it)g(unsatisfactory)e(that)i(his)f(inter)o(-)1020 1766
y(pr)o(eter)9 b(always)g(had)f(an)h(envir)o(onment)f(ar)o(gument,)h(even)g
(though)f(it)1020 1807 y(was)h(only)g(used)f(in)h(the)g(function)g(building)f
(block.)13 b(By)c(abstracting)1020 1849 y(envir)o(onment-r)o(elated)h
(operations)g(as)f(two)i(functions)e(\()p Fq(inEnv)h Fr(and)1020
1890 y Fq(rdEnv)p Fr(\),)g(we)g(achieve)f(exactly)h(what)g(Steele)g(wished)g
(for)m(.)1020 1988 y Fs(5.3)41 b(The)10 b(References)h(and)f(Assignment)g
(Building)f(Blo)q(ck)1020 2056 y Fr(A)h(sublanguage)e(of)j(r)o(efer)o(ences)f
(and)f(assignment)g(is)h(given)g(by:)1039 2125 y Fh(data)g
Fq(T)l(ermR)36 b Fg(=)h Fq(Ref)10 b(T)l(erm)1270 2166 y Ff(j)47
b Fq(Der)o(ef)10 b(T)l(erm)1270 2208 y Ff(j)47 b Fq(Assign)9
b(T)l(erm)g(T)l(erm)1020 2277 y Fr(Given)22 b(a)g(heap)g(of)i(memory)e(cells)
g(and)f(thr)o(ee)i(functions)f(for)1020 2318 y(managing)9 b(it:)1039
2387 y Fq(allocLoc)75 b Fr(::)44 b Fq(InterpM)10 b(Loc)1039
2429 y(lookupLoc)43 b Fr(::)h Fq(Loc)10 b Ff(!)h Fq(InterpM)f(V)m(alue)1039
2470 y(updateLoc)41 b Fr(::)j Fg(\()p Fq(Loc)o Fe(;)17 b Fq(InterpM)10
b(V)m(alue)o Fg(\))h Ff(!)g Fq(InterpM)f Fg(\(\))1039 2512
y Fh(type)g Fq(Loc)53 b Fg(=)38 b Fq(Int)1020 2581 y Fr(we)14
b(can)f(then)h(give)g(an)g(appr)o(opriate)h(interpr)o(etation)f(to)h(the)f
(new)1020 2622 y(language)8 b(featur)o(es:)961 2747 y(4)p eop
%%Page: 5 5
5 4 bop -76 -74 2093 2 v 200 23 a Fh(instance)10 b Fq(InterpC)f(T)l(ermF)g
Fh(where)275 64 y Fq(interp)h Fg(\()p Fq(V)m(ar)f Fe(v)q Fg(\))153
b(=)37 b Fq(rdEnv)9 b Fr(`)p Fq(bind)p Fr(`)i Ff(n)p Fq(env)f
Ff(!)712 106 y Fh(case)f Fq(lookupEnv)f Fe(v)j Fq(env)f Fh(of)749
147 y Fq(Just)h(val)47 b Ff(!)38 b Fq(val)749 189 y(Nothing)f
Ff(!)h Fq(err)9 b Fg(\()p Fq("unbound)f(variable:)14 b(")c(++)g(v)p
Fg(\))275 237 y Fq(interp)g Fg(\()p Fq(LambdaN)f Fe(s)h(t)p
Fg(\))38 b(=)f Fq(rdEnv)9 b Fr(`)p Fq(bind)p Fr(`)i Ff(n)p
Fq(env)f Ff(!)712 278 y Fq(unitInj)h Fg(\()p Ff(n)p Fq(ar)o(g)f
Ff(!)h Fq(inEnv)f Fg(\()p Fq(extendEnv)e Fg(\()p Fe(s;)16 b
Fq(ar)o(g)p Fg(\))10 b Fq(env)o Fg(\))g(\()p Fq(interp)g Fe(t)p
Fg(\)\))275 346 y Fq(interp)g Fg(\()p Fq(LambdaV)f Fe(s)h(t)p
Fg(\))40 b(=)d Fq(rdEnv)9 b Fr(`)p Fq(bind)p Fr(`)i Ff(n)p
Fq(env)f Ff(!)712 388 y Fq(unitInj)h Fg(\()p Ff(n)p Fq(ar)o(g)f
Ff(!)30 b Fq(ar)o(g)9 b Fr(`)p Fq(bind)q Fr(`)i Ff(n)p Fe(v)g
Ff(!)992 429 y Fq(inEnv)f Fg(\()p Fq(extendEnv)e Fg(\()p Fe(s;)16
b Fq(unit)11 b Fe(v)q Fg(\))f Fq(env)o Fg(\))g(\()p Fq(interp)g
Fe(t)p Fg(\)\))275 471 y Fq(interp)g Fg(\()p Fq(App)f Fe(e)484
475 y Fk(1)509 471 y Fe(e)527 475 y Fk(2)542 471 y Fg(\))88
b(=)37 b Fq(interp)9 b Fe(e)831 475 y Fk(1)856 471 y Fr(`)p
Fq(bindPrj)q Fr(`)h Ff(n)p Fe(f)15 b Ff(!)712 512 y Fq(rdEnv)9
b Fr(`)p Fq(bind)p Fr(`)i Ff(n)p Fq(env)f Ff(!)712 554 y Fe(f)k
Fg(\()p Fq(inEnv)c(env)f Fg(\()p Fq(interp)h Fe(e)1063 558
y Fk(2)1077 554 y Fg(\)\))659 676 y Fr(Figur)o(e)f(2:)15 b(The)10
b(function)g(building)e(block)p -76 706 V -57 810 a Fh(instance)h
Fq(InterpC)h(T)l(ermR)f Fh(where)-1 851 y Fq(interp)h Fg(\()p
Fq(Ref)g Fe(x)p Fg(\))g(=)167 893 y Fq(interp)g Fe(x)g Fr(`)p
Fq(bind)p Fr(`)h Ff(n)p Fq(val)g Ff(!)167 934 y Fq(allocLoc)f
Fr(`)p Fq(bind)q Fr(`)g Ff(n)p Fq(loc)h Ff(!)167 976 y Fq(updateLoc)e
Fg(\()p Fq(loc)p Fe(;)16 b Fq(unit)11 b(val)p Fg(\))f Fr(`)p
Fq(bind)p Fr(`)h Ff(n)p 681 976 12 2 v 25 w(!)167 1017 y Fq(unitInj)g(loc)-1
1076 y(interp)f Fg(\()p Fq(Der)o(ef)f Fe(x)p Fg(\))i(=)167
1118 y Fq(interp)f Fe(x)g Fr(`)p Fq(bindPrj)p Fr(`)h Ff(n)p
Fq(loc)g Ff(!)167 1159 y Fq(lookupLoc)e(loc)-1 1260 y(interp)h
Fg(\()p Fq(Assign)f(lhs)h(r)o(hs)o Fg(\))g(=)167 1301 y Fq(interp)g(lhs)g
Fr(`)p Fq(bindPrj)p Fr(`)h Ff(n)p Fq(loc)g Ff(!)167 1343 y
Fq(interp)f(r)o(hs)f Fr(`)p Fq(bind)q Fr(`)h Ff(n)p Fq(val)h
Ff(!)167 1384 y Fq(updateLoc)e Fg(\()p Fq(loc)p Fe(;)16 b Fq(unit)11
b(val)p Fg(\))f Fr(`)p Fq(bind)p Fr(`)h Ff(n)p 681 1384 V 25
w(!)167 1426 y Fq(unit)g(val)-76 1525 y Fs(5.4)41 b(A)11 b(Lazy)e(Evaluation)
f(Building)g(Blo)q(ck)-76 1593 y Fr(Using)h(this)g(same)h(heap)f(of)i(memory)
e(cells)g(for)h(r)o(efer)o(ences,)g(we)f(can)-76 1635 y(implement)h
(\252lazy\272)f(abstractions:)-57 1705 y Fh(data)h Fq(T)l(ermL)36
b Fg(=)h Fq(LambdaL)9 b(Name)h(T)l(erm)-76 1777 y Fr(whose)h(operational)f
(semantics)f(implies)h(\252caching\272)e(of)j(r)o(esults.)-57
1882 y Fh(instance)e Fq(InterpC)h(T)l(ermL)f Fh(where)-1 1924
y Fq(interp)h Fg(\()p Fq(LambdaL)f Fe(s)h(t)p Fg(\))g(=)74
1965 y Fq(rdEnv)e Fr(`)p Fq(bind)q Fr(`)j Ff(n)p Fq(env)f Ff(!)74
2007 y Fq(unitInj)h Fg(\()p Ff(n)p Fq(ar)o(g)f Ff(!)130 2048
y Fq(allocLoc)g Fr(`)p Fq(bind)p Fr(`)h Ff(n)p Fq(loc)g Ff(!)130
2090 y Fh(let)g Fq(thunk)e Fg(=)i Fq(ar)o(g)f Fr(`)p Fq(bind)p
Fr(`)h Ff(n)p Fe(v)h Ff(!)324 2131 y Fq(updateLoc)d Fg(\()p
Fq(loc)p Fe(;)16 b Fq(unit)11 b Fe(v)q Fg(\))f Fr(`)p Fq(bind)q
Fr(`)h Ff(n)p 813 2131 V 24 w(!)324 2173 y Fq(unit)g Fe(v)130
2214 y Fh(in)130 2256 y Fq(updateLoc)d Fg(\()p Fq(loc)p Fe(;)17
b Fq(thunk)o Fg(\))10 b Fr(`)p Fq(bind)q Fr(`)h Ff(n)p 613
2256 V 24 w(!)130 2297 y Fq(inEnv)18 b Fg(\()p Fq(extendEnv)8
b Fg(\()p Fe(s;)16 b Fq(lookupLoc)9 b(loc)p Fg(\))h Fq(env)o
Fg(\))242 2339 y(\()p Fq(interp)f Fe(t)p Fg(\)\))-76 2412 y
Fr(Upon)j(entering)f(a)g(lazy)g(function,)h(the)f(interpr)o(eter)g(\256rst)g
(allocates)-76 2454 y(a)i(memory)g(cell)f(and)g(stor)o(es)h(a)g(thunk)f
(\(updatable)g(closur)o(e\))g(in)h(it.)-76 2495 y(When)g(the)g(ar)o(gument)f
(is)g(\256rst)h(evaluated)f(in)g(the)h(function)g(body)l(,)-76
2537 y(the)c(interpr)o(eter)f(evaluates)g(the)h(thunk)f(and)g(stor)o(es)h
(the)f(r)o(esult)h(back)-76 2578 y(into)i(the)f(memory)g(cell,)g(overwriting)
g(the)g(thunk)f(itself.)1020 822 y Fs(5.5)41 b(A)10 b(Program)g(T)m(racing)f
(Building)g(Blo)q(ck)1020 890 y Fr(Given)h(a)g(function:)1039
960 y Fq(write)37 b Fr(::)h Fq(String)10 b Ff(!)h Fq(InterpM)f
Fg(\(\))1020 1033 y Fr(which)e(writes)g(a)g(string)g(output)h(and)f
(continues)g(the)g(computation,)1020 1074 y(we)g(can)f(de\256ne)g(a)h
(\252tracing\272)e(sublanguage,)g(which)h(attaches)f(labels)1020
1116 y(to)15 b(expr)o(essions)f(which)g(cause)f(a)h(\252trace)f(r)o(ecor)o
(d\272)h(to)h(be)f(invoked)1020 1157 y(whenever)c(that)g(expr)o(ession)g(is)h
(evaluated:)1039 1228 y Fh(data)f Fq(T)l(ermT)f Fg(=)i Fq(T)l(race)d(String)i
(T)l(erm)1039 1342 y Fh(instance)f Fq(InterpC)h(T)l(ermT)f
Fh(where)1095 1383 y Fq(interp)g Fg(\()p Fq(T)l(race)g Fe(l)j(t)p
Fg(\))e(=)1151 1425 y Fq(write)g Fg(\()p Fq("enter)f(")h(++)g(l)p
Fg(\))g Fr(`)p Fq(bind)q Fr(`)h Ff(n)p 1601 1425 V 24 w(!)1151
1466 y Fq(interp)f Fe(t)g Fr(`)p Fq(bind)p Fr(`)h Ff(n)p Fe(v)h
Ff(!)1151 1508 y Fq(write)e Fg(\()p Fq("leave)f(")h(++)f(l)i(++)f(")g(with:")
h(++)e(show)h(v)o Fg(\))h Fr(`)p Fq(bind)p Fr(`)g Ff(n)p 1962
1508 V 24 w(!)1151 1549 y Fq(unit)g Fe(v)1020 1631 y Fr(Her)o(e)18
b(we)h(see)f(that)g(some)g(of)h(the)f(featur)o(es)g(in)g(Kishon)g(et)g(al.'s)
1020 1672 y(system)10 b([12])h(ar)o(e)f(easily)f(incorporated)h(into)g(our)g
(interpr)o(eter)m(.)1020 1771 y Fs(5.6)41 b(The)10 b(Continuation)f(Building)
g(Blo)q(ck)1020 1839 y Fr(First-class)16 b(continuations)g(can)h(be)g
(included)e(in)i(our)g(language)1020 1880 y(with:)1039 1951
y Fh(data)10 b Fq(T)l(ermC)36 b Fg(=)h Fq(CallCC)1020 2023
y Fr(Using)10 b(the)g Fq(callcc)h Fr(semantic)e(function)h(\(to)i(be)e
(de\256ned)f(later\):)1039 2093 y Fq(callcc)38 b Fr(::)g Fg(\(\()p
Fe(a)11 b Ff(!)g Fq(InterpM)f Fe(b)p Fg(\))h Ff(!)g Fq(InterpM)f
Fe(a)p Fg(\))h Ff(!)g Fq(InterpM)f Fe(a)1020 2166 y Fr(we)g(can)g(give)g(an)g
(interpr)o(etation)g(for)h Fq(CallCC)p Fr(:)1039 2239 y Fh(instance)e
Fq(InterpC)h(T)l(ermC)f Fh(where)1095 2281 y Fq(interp)g(CallCC)i
Fg(=)g Fq(unitInj)g Fg(\()p Ff(n)p Fe(f)k Ff(!)1151 2323 y
Fe(f)f Fr(`)p Fq(bindPrj)p Fr(`)d Ff(n)p Fe(f)1372 2307 y Fd(0)1394
2323 y Ff(!)1151 2365 y Fq(callcc)g Fg(\()p Ff(n)p Fe(k)h Ff(!)f
Fg(\()p Fe(f)1397 2349 y Fd(0)1418 2365 y Fg(\()p Fq(unitInj)h
Fg(\()p Ff(n)p Fe(a)f Ff(!)g Fe(a)g Fr(`)p Fq(bind)p Fr(`)g
Fe(k)q Fg(\)\)\)\)\))1020 2439 y Fq(CallCC)i Fr(is)g(interpr)o(eted)g(as)g(a)
g(\(strict\))g(builtin)f(function.)23 b Fq(Interp)13 b Fr(in)1020
2480 y(this)c(case)g(does)h(nothing)f(mor)o(e)h(than)f(inject)g(and)g(pr)o
(oject)h(values)f(to)1020 2522 y(the)h(right)g(domains.)961
2747 y(5)p eop
%%Page: 6 6
6 5 bop 364 -36 1212 2 v 363 6 2 42 v 387 -7 a Fh(Feature)p
692 6 V 544 w(Function)p 1575 6 V 364 7 1212 2 v 364 16 V 363
58 2 42 v 387 45 a Fr(Err)o(or)10 b(handling)p 692 58 V 300
w Fq(err)f Fr(::)15 b Fq(String)10 b Ff(!)h Fq(InterpM)f(a)p
1575 58 V 364 59 1212 2 v 363 101 2 42 v 387 89 a Fr(Nondeterminism)p
692 101 V 197 w Fq(mer)o(ge)f Fr(::)15 b([)p Fq(InterpM)c(a)p
Fr(])f Ff(!)h Fq(InterpM)f Fr(a)p 1575 101 V 364 103 1212 2
v 363 144 2 42 v 387 132 a(Envir)o(onment)p 692 144 V 359 w
Fq(rdEnv)f Fr(::)16 b Fq(InterpM)10 b(Env)p 1575 144 V 363
186 V 692 186 V 819 173 a(inEnv)g Fr(::)15 b Fq(Env)10 b Ff(!)h
Fq(InterpM)f(a)g Ff(!)g Fq(InterpM)g Fr(a)p 1575 186 V 364
187 1212 2 v 363 229 2 42 v 387 216 a(Stor)o(e)p 692 229 V
489 w Fq(allocLoc)g Fr(::)15 b Fq(InterpM)10 b(Int)p 1575 229
V 363 270 V 692 270 V 872 258 a(lookupLoc)e Fr(::)15 b Fq(Int)c
Ff(!)g Fq(InterpM)f(V)m(alue)p 1575 270 V 363 312 V 692 312
V 756 299 a(updateLoc)f Fr(::)15 b(\()p Fq(Int)p Fr(,)d Fq(InterpM)e(V)m
(alue)p Fr(\))g Ff(!)h Fq(InterpM)f(Int)p 1575 312 V 364 314
1212 2 v 363 355 2 42 v 387 343 a Fr(String)f(output)p 692
355 V 304 w Fq(write)h Fr(::)16 b Fq(String)10 b Ff(!)g Fq(InterpM)g
Fr(\(\))p 1575 355 V 364 357 1212 2 v 363 398 2 42 v 387 386
a(Continuations)p 692 398 V 93 w Fq(callcc)h Fr(::)k(\(\()p
Fq(a)c Ff(!)g Fq(InterpM)f(b)p Fr(\))h Ff(!)g Fq(InterpM)f(a)p
Fr(\))g Ff(!)h Fq(InterpM)f(a)p 1575 398 V 364 400 1212 2 v
552 473 a Fr(T)m(able)f(1:)15 b(Monad)10 b(operations)h(used)e(by)h(the)g
(interpr)o(eter)-76 638 y Fs(5.7)41 b(The)11 b(Nondeterminism)e(Building)g
(Blo)q(ck)-76 705 y Fr(Our)h(nondeterministic)f(sublanguage)e(is)j(given)g
(by:)-57 776 y Fh(data)g Fq(T)l(ermN)36 b Fg(=)h Fq(Amb)11
b Fg([)p Fq(T)l(erm)n Fg(])-76 848 y Fr(Given)f(a)g(function:)-57
919 y Fq(mer)o(ge)36 b Fr(::)i Fg([)p Fq(InterpM)10 b Fe(a)p
Fg(])g Ff(!)h Fq(InterpM)f Fe(a)-76 991 y Fr(which)f(mer)o(ges)h(a)g(list)g
(of)h(computations)f(into)g(a)g(single)f(\(nondeter)o(-)-76
1032 y(ministic\))17 b(computation,)j(nondeterminism)c(interpr)o(etation)h
(can)-76 1074 y(be)10 b(expr)o(essed)g(as:)-57 1148 y Fh(instance)f
Fq(InterpC)h(T)l(ermN)f Fh(where)-20 1189 y Fq(interp)h Fg(\()p
Fq(Amb)h Fe(t)p Fg(\))f(=)h Fq(mer)o(ge)e Fg(\()p Fq(map)g(interp)h
Fe(t)p Fg(\))-76 1293 y Fs(6)41 b(Monads)9 b(With)g(Op)q(erations)-76
1375 y Fr(As)k(mentioned)g(earlier)m(,)g(particular)f(monads)g(have)h(other)g
(opera-)-76 1416 y(tions)f(besides)f Fq(unit)h Fr(and)f Fq(bind)p
Fr(.)20 b(Indeed,)11 b(fr)o(om)i(the)f(last)f(section,)h(it)-76
1458 y(is)e(clear)f(that)i(operations)f(listed)g(in)g(T)m(able)f(1)h(must)g
(be)g(supported.)-20 1499 y(If)h(we)f(wer)o(e)g(building)f(an)g(interpr)o
(eter)h(in)g(the)g(traditional)g(way)l(,)-76 1541 y(now)15
b(is)f(the)g(time)g(to)h(set)f(up)g(the)g(domains)g(and)f(implement)i(the)-76
1582 y(functions)h(listed)f(in)h(the)g(table.)32 b(The)16 b(major)f(drawback)
g(of)i(this)-76 1624 y(monolithic)10 b(appr)o(oach)h(is)f(that)h(we)g(have)f
(to)h(take)f(into)h(account)e(all)-76 1665 y(other)j(featur)o(es)f(when)g(we)
g(de\256ne)f(an)h(operation)h(for)g(one)g(speci\256c)-76 1707
y(featur)o(e.)34 b(When)16 b(we)h(de\256ne)e Fq(callcc)p Fr(,)20
b(for)d(example,)i(we)e(have)f(to)-76 1748 y(decide)11 b(how)i(it)f
(interacts)f(with)h(the)g(stor)o(e)h(and)f(envir)o(onment)f(etc.)-76
1790 y(And)17 b(if)g(we)g(later)f(want)h(to)g(add)f(mor)o(e)i(featur)o(es,)g
(the)f(semantic)-76 1831 y(domains)d(and)h(all)f(the)h(functions)f(in)g(the)h
(table)f(will)h(have)f(to)i(be)-76 1873 y(updated.)-20 1914
y Fq(Monad)7 b(transformers)p Fr(,)f(on)i(the)f(other)h(hand,)g(allow)f(us)h
(to)g Fq(individ-)-76 1956 y(ually)i Fr(captur)o(e)f(the)h(essence)f(of)i
(language)d(featur)o(es.)14 b(Furthermor)o(e,)-76 1997 y(the)9
b(concept)g(of)h Fq(lifting)g Fr(allows)f(us)f(to)i(account)d(for)j(the)f
(interactions)-76 2039 y(between)14 b(various)f(featur)o(es.)26
b(These)13 b(ar)o(e)h(the)g(topics)g(of)h(the)f(next)-76 2080
y(two)d(sections.)-20 2122 y(T)m(o)f(simplify)g(the)g(set)g(of)h(operations)g
(somewhat,)f(we)g(note)h(that)-76 2163 y(both)k(the)g(stor)o(e)h(and)e
(output)h(\(used)g(by)g(the)g(tracer\))f(have)h(to)g(do)-76
2205 y(with)9 b(some)g(notion)g(of)h Fq(state)p Fr(.)k(Thus)8
b(we)h(de\256ne)f Fq(allocLoc)p Fr(,)h Fq(lookupLoc)p Fr(,)-76
2246 y Fq(updateLoc)p Fr(,)g(and)h Fq(write)g Fr(in)g(terms)g(of)h(just)f
(one)g(function:)-57 2317 y Fq(update)36 b Fr(::)i Fg(\()p
Fe(s)10 b Ff(!)h Fe(s)p Fg(\))g Ff(!)g Fq(InterpM)f Fe(s)-76
2389 y Fr(for)h(some)f(suitably)e(chosen)h Fq(s)p Fr(.)14 b(W)m(e)c(can)e(r)o
(ead)i(the)f(state)h(by)f(passing)-76 2431 y Fq(update)g Fr(the)g(identity)h
(function,)f(and)g(change)g(the)g(state)h(by)f(passing)-76
2472 y(it)i(a)f(state)g(transformer)m(.)k(For)d(example:)-57
2546 y Fq(write)f(msg)37 b Fg(=)g Fq(update)9 b Fg(\()p Ff(n)i
Fq(sofar)e Ff(!)i Fq(sofar)e(++)h(msg)o Fg(\))199 2587 y Fr(`)p
Fq(bind)p Fr(`)h Ff(n)p 318 2587 12 2 v 25 w(!)g Fq(unit)f
Fg(\(\))1020 638 y Fs(7)41 b(Monad)9 b(T)m(ransfo)o(rmers)1020
719 y Fr(T)m(o)17 b(get)g(an)g(intuitive)f(feel)h(for)h(monad)f
(transformers,)h(consider)1020 761 y(the)13 b(mer)o(ging)f(of)i(a)f(state)g
(monad)f(with)h(an)g(arbitrary)e(monad,)j(an)1020 802 y(example)c(adapted)g
(fr)o(om)i(Jones's)f(constructor)e(class)g(paper)h([9)q(]:)1039
873 y Fh(type)g Fq(StateT)g Fe(s)g(m)g(a)38 b Fg(=)f Fe(s)11
b Ff(!)g Fe(m)f Fg(\()p Fe(s;)c(a)p Fg(\))1020 945 y Fr(Note)22
b(that)g(the)f(type)h(variable)e Fq(m)i Fr(above)g(stands)e(for)j(a)e(type)
1020 987 y(constructor)m(,)c(a)g(fact)f(automatically)f(determined)h(by)g
(the)g(Gofer)1020 1028 y(kind)11 b(infer)o(ence)g(system.)20
b(It)12 b(turns)f(out)h(that)g(if)g Fq(m)g Fr(is)g(a)g(monad,)g(so)1020
1076 y(is)e(\252)p Fq(StateT)g(s)g(m)p Fr(\272.)1268 1060 y
Fk(5)1297 1076 y Fr(\252)p Fq(StateT)g(s)p Fr(\272)f(is)h(thus)g(a)g(monad)g
(transformer)m(.)1076 1118 y(For)g(example,)h(if)g(we)f(substitute)f(the)i
(identity)e(monad:)1039 1188 y Fh(type)h Fq(Id)g Fe(a)38 b
Fg(=)f Fe(a)1020 1260 y Fr(for)11 b Fq(m)f Fr(in)g(the)h(above)f(monad)g
(transformer)m(,)g(we)h(arrive)e(at:)1039 1329 y Fq(StateT)h
Fe(s)g Fq(Id)g Fe(a)38 b Fg(=)f Fe(s)11 b Ff(!)g Fq(Id)g Fg(\()p
Fe(s;)5 b(a)p Fg(\))1276 1371 y(=)37 b Fe(s)11 b Ff(!)g Fg(\()p
Fe(s;)6 b(a)p Fg(\))1020 1444 y Fr(which)14 b(is)h(the)f(standar)o(d)g(state)
h(monad)f(found,)j(for)e(example,)i(in)1020 1486 y(W)m(adler)s('s)9
b(work)i([21].)1076 1527 y(The)d(power)h(of)h(monad)e(transformers)g(is)g
(two-fold.)16 b(First,)9 b(they)1020 1569 y(add)f(operations)h(\(i.e.)g(intr)
o(oduce)f(new)h(featur)o(es\))f(to)i(a)e(monad.)14 b(The)1020
1610 y Fq(StateT)8 b Fr(monad)g(transformer)f(above,)i(for)g(example,)g(adds)
e(state)h Fq(s)g Fr(to)1020 1652 y(the)j(monad)g(it)g(is)g(applied)g(to,)h
(and)e(the)h(r)o(esulting)f(monad)h(accepts)1020 1693 y Fq(update)e
Fr(as)h(a)g(legitimate)g(operation)g(on)h(it.)1076 1735 y(Second,)h(monad)f
(transformers)h(compose)g(easily)l(.)18 b(For)12 b(exam-)1020
1776 y(ple,)j(applying)e(both)g(\252)p Fq(StateT)g(s)p Fr(\272)f(and)h(\252)p
Fq(StateT)f(t)p Fr(\272)i(to)g(the)f(identity)1020 1818 y(monad,)d(we)h(get:)
1039 1892 y Fq(StateT)f Fe(t)g Fg(\()p Fq(StateT)g Fe(s)g Fq(Id)p
Fg(\))h Fe(a)37 b Fg(=)g Fe(t)11 b Ff(!)g Fg(\()p Fq(StateT)f
Fe(s)g Fq(Id)p Fg(\))h(\()p Fe(t;)6 b(a)p Fg(\))1440 1933 y(=)37
b Fe(t)11 b Ff(!)g Fe(s)g Ff(!)g Fg(\()p Fe(s;)6 b Fg(\()p
Fe(t;)f(a)p Fg(\)\))1020 2007 y Fr(which)12 b(is)g(the)h(expected)f(type)h
(signatur)o(e)e(for)j(transforming)d(both)1020 2048 y(states)17
b Fq(s)g Fr(and)f Fq(t)p Fr(.)36 b(The)17 b(observant)g(r)o(eader)f(will)h
(note,)j(however)m(,)1020 2090 y(an)11 b(immediate)f(pr)o(oblem:)17
b(in)10 b(the)h(r)o(esulting)f(monad,)h(which)g(state)1020
2131 y(does)17 b Fq(update)f Fr(act)g(upon?)34 b(In)16 b(general,)i(this)f
(is)f(the)h(pr)o(oblem)g(of)1020 2173 y Fq(lifting)23 b Fr(monad)d
(operations)h(thr)o(ough)g(transformers,)i(and)e(will)1020
2214 y(be)c(addr)o(essed)f(in)h(detail)g(later)m(.)35 b(But)17
b(\256rst)g(we)g(de\256ne)g(monads)1020 2256 y(and)c(monad)h(transformers)f
(mor)o(e)h(formally)l(,)h(and)e(then)g(describe)1020 2297 y(monad)h
(transformers)f(covering)g(the)h(featur)o(es)f(listed)g(in)h(Section)1020
2339 y(5.)1076 2380 y(W)m(e)c(can)g(formally)g(de\256ne)f(monads)h(as)g
(follows:)p 1020 2414 399 2 v 1060 2439 a Fj(5)1072 2451 y
Fo(In)g(fact)f(\252)p Fi(StateT)f(s)i(m)p Fo(\272)e(is)j(only)f(legal)g(in)f
(the)h(curr)o(ent)h(version)g(of)e(Gofer)g(if)h Fi(StateT)1020
2485 y Fo(is)j(a)e(datatype)h(rather)g(than)g(a)f(type)i(synonym.)18
b(This)12 b(does)f(not)h(limit)i(our)d(r)o(esults,)1020 2518
y(but)j(does)h(intr)o(oduce)g(super\257uous)f(data)g(constructors)h(that)g
(slightly)i(complicate)1020 2551 y(the)11 b(pr)o(esentation,)j(so)d(we)h
(will)g(use)f Fi(type)f Fo(declarations)i(as)f(if)g(they)h(worked)f(as)g
Fi(data)1020 2584 y Fo(declarations.)961 2747 y Fr(6)p eop
%%Page: 7 7
7 6 bop -57 -47 a Fh(class)9 b Fq(Monad)g Fe(m)i Fh(where)-1
-5 y Fq(unit)40 b Fr(::)e Fe(a)11 b Ff(!)g Fe(m)g(a)-1 36 y
Fq(bind)37 b Fr(::)h Fe(m)11 b(a)g Ff(!)g Fg(\()p Fe(a)g Ff(!)g
Fe(m)f(b)p Fg(\))h Ff(!)g Fe(m)f(b)-1 95 y Fq(map)37 b Fr(::)h
Fg(\()p Fe(a)11 b Ff(!)g Fe(b)p Fg(\))g Ff(!)g Fe(m)f(a)h Ff(!)g
Fe(m)f(b)-1 137 y Fq(join)44 b Fr(::)38 b Fe(m)10 b Fg(\()p
Fe(m)g(a)p Fg(\))h Ff(!)g Fe(m)f(a)-1 196 y Fq(map)g Fe(f)k(m)37
b Fg(=)g Fe(m)10 b Fr(`)p Fq(bind)q Fr(`)h Ff(n)p Fe(a)g Ff(!)g
Fq(unit)g Fg(\()p Fe(f)j(a)p Fg(\))-1 237 y Fq(join)c Fe(z)93
b Fg(=)37 b Fe(z)12 b Fr(`)p Fq(bind)p Fr(`)f Fq(id)-76 311
y Fr(The)h(two)h(functions)f Fq(map)g Fr(and)g Fq(join)p Fr(,)h(together)g
(with)f Fq(unit)h Fr(pr)o(ovide)-76 352 y(an)h(equivalent)g(de\256nition)f
(of)j(monads,)g(but)e(ar)o(e)g(easily)g(de\256ned)-76 394 y(\(as)c(default)g
(methods\))h(in)f(terms)g(of)h Fq(bind)g Fr(and)e Fq(unit)p
Fr(.)-20 435 y(T)m(o)f(be)g(a)g(monad,)g Fq(bind)g Fr(and)g
Fq(unit)g Fr(must)g(satisfy)f(the)h(well-known)-76 477 y Fq(Monad)h(Laws)h
Fr([21)o(]:)-76 527 y(Left)h(unit:)243 568 y Fg(\()p Fq(unit)g
Fe(a)p Fg(\))g Fr(`)p Fq(bind)p Fr(`)g Fe(k)h Fg(=)e Fe(k)i(a)-76
633 y Fr(Right)e(unit:)276 673 y Fe(m)h Fr(`)p Fq(bind)p Fr(`)g
Fq(unit)g Fg(=)f Fe(m)-76 738 y Fr(Associativity:)7 816 y Fe(m)h
Fr(`)p Fq(bind)p Fr(`)g Ff(n)p Fe(a)g Ff(!)g Fg(\()p Fe(k)h(a)e
Fr(`)p Fq(bind)q Fr(`)h Fe(h)p Fg(\))f(=)h(\()p Fe(m)f Fr(`)p
Fq(bind)q Fr(`)g Fe(k)q Fg(\))h Fr(`)p Fq(bind)p Fr(`)g Fe(h)-76
896 y Fr(W)m(e)16 b(de\256ne)e(a)h(monad)h(transformer)f(as)g(any)g(type)h
(constructor)e Fq(t)-76 937 y Fr(such)i(that)g(if)i Fq(m)f
Fr(is)f(a)h(monad)g(\(based)f(on)h(the)g(above)f(laws\),)j(so)-76
979 y(is)d(\252)p Fq(t)g(m)p Fr(\272.)31 b(W)m(e)16 b(can)f(expr)o(ess)i
(this)e(\(other)i(than)e(the)h(veri\256cation)-76 1020 y(of)d(the)f(laws,)g
(which)f(is)g(generally)f(undecidable\))g(using)h(the)g(two-)-76
1062 y(parameter)f(constructor)f(class)g Fq(MonadT)p Fr(:)-57
1135 y Fh(class)g Fg(\()p Fq(Monad)g Fe(m;)17 b Fq(Monad)9
b Fg(\()p Fe(t)h(m)p Fg(\)\))g Ff(\))h Fq(MonadT)f Fe(t)g(m)g
Fh(where)-1 1177 y Fq(lift)39 b Fr(::)f Fe(m)10 b(a)h Ff(!)g
Fe(t)f(m)h(a)-76 1251 y Fr(The)i(member)g(function)g Fq(lift)i
Fr(embeds)d(a)h(computation)h(in)f(monad)-76 1293 y Fq(m)19
b Fr(into)f(monad)g(\252)p Fq(t)h(m)p Fr(\272.)38 b(Furthermor)o(e,)20
b(we)e(expect)h(a)f(monad)-76 1335 y(transformer)12 b(to)g
Fq(add)f Fr(featur)o(es,)i(without)f(changing)e(the)h(natur)o(e)h(of)-76
1376 y(an)i(existing)h(computation.)28 b(W)m(e)15 b(intr)o(oduce)f
Fq(Monad)g(T)l(ransformer)-76 1418 y(Laws)9 b Fr(to)i(captur)o(e)f(the)g(pr)o
(operties)i(of)f Fq(lift)p Fr(:)55 1491 y Fq(lift)f Ff(\001)e
Fq(unit)190 1495 y Fc(m)257 1491 y Fg(=)37 b Fq(unit)389 1495
y Fc(tm)-57 1533 y Fq(lift)12 b Fg(\()p Fe(m)e Fr(`)p Fq(bind)133
1537 y Fc(m)163 1533 y Fr(`)h Fe(k)q Fg(\))37 b(=)g Fq(lift)12
b Fe(m)e Fr(`)p Fq(bind)500 1537 y Fc(tm)541 1533 y Fr(`)h
Fg(\()p Fq(lift)f Ff(\001)e Fe(k)q Fg(\))-20 1606 y Fr(The)g(above)h(laws)f
(say)g(that)g(lifting)h(a)f(null)g(computation)g(r)o(esults)-76
1648 y(in)14 b(a)g(null)g(computation,)i(and)d(that)i(lifting)f(a)g(sequence)
f(of)i(com-)-76 1689 y(putations)10 b(is)g(equivalent)f(to)i(\256rst)f
(lifting)g(them)g(individually)l(,)e(and)-76 1731 y(then)i(combining)f(them)h
(in)g(the)g(lifted)h(monad.)-20 1772 y(Speci\256c)c(monad)i(transformers)f
(ar)o(e)g(described)f(in)h(the)h(r)o(emain-)-76 1814 y(der)h(of)g(this)g
(section.)k(Some)c(of)h(these)e(\()p Fq(StateT)p Fr(,)i Fq(ContT)p
Fr(,)f(and)f Fq(Err)o(orT)p Fr(\))-76 1855 y(appear)14 b(in)f(an)g(abstract)g
(form)h(in)f(Moggi's)h(note)g([15].)25 b(The)14 b Fq(envi-)-76
1897 y(r)o(onment)e Fr(monad)h(is)g(similar)f(to)h(the)g Fq(state)g(r)o
(eader)d Fr(by)j(W)m(adler)f([22].)-76 1938 y(The)e Fq(state)f
Fr(and)h Fq(envir)o(onment)e Fr(monad)i(transformers)g(ar)o(e)f(r)o(elated)h
(to)-76 1980 y(ideas)g(found)g(in)g(Jones)h(and)e(Duponcheel's)h([9])h([10])f
(work.)-76 2078 y Fs(7.1)41 b(State)10 b(Monad)f(T)m(ransfo)o(rmer)-76
2146 y Fr(Recall)g(the)i(de\256nition)e(of)i(state)f(monad)g(transformer)g
Fq(StateT)p Fr(:)-57 2216 y Fh(type)g Fq(StateT)g Fe(s)g(m)g(a)38
b Fg(=)f Fe(s)11 b Ff(!)g Fe(m)f Fg(\()p Fe(s;)c(a)p Fg(\))-76
2289 y Fr(Using)15 b(instance)f(declarations,)h(we)g(now)h(wish)e(to)i
(declar)o(e)e(both)-76 2330 y(that)d(\252)p Fq(StateT)f(s)h(m)p
Fr(\272)g(is)f(a)h(monad)g(\(given)f Fq(m)h Fr(is)g(a)g(monad\),)g(and)g
(that)-76 2372 y(\252)p Fq(StateT)j(s)p Fr(\272)h(is)f(a)h(monad)g
(transformer)f(\(for)i(each)e(of)i(the)f(monad)-76 2413 y(transformers)c
(de\256ned)g(in)g(subsequent)e(subsections,)i(we)h(will)f(do)-76
2455 y(exactly)f(the)g(same)g(thing\).)-20 2496 y(First,)h(we)f(establish)g
(the)g(monad)g(de\256nition)g(for)h(\252)p Fq(StateT)f(s)g(m)p
Fr(\272,)-76 2538 y(involving)g(methods)g(for)h Fq(unit)g Fr(and)f
Fq(bind)p Fr(:)1039 -47 y Fh(instance)f Fq(Monad)g Fe(m)i Ff(\))g
Fq(Monad)e Fg(\()p Fq(StateT)h Fe(s)g(m)p Fg(\))h Fh(where)1095
-5 y Fq(unit)g Fe(x)104 b Fg(=)37 b Ff(n)p Fe(s)11 b Ff(!)g
Fq(unit)f Fg(\()p Fe(s;)c(x)p Fg(\))1095 36 y Fe(m)k Fr(`)p
Fq(bind)p Fr(`)h Fe(k)39 b Fg(=)e Ff(n)p Fe(s)1400 40 y Fk(0)1425
36 y Ff(!)30 b Fe(m)10 b(s)1555 40 y Fk(0)1580 36 y Fr(`)p
Fq(bind)p Fr(`)h Ff(n)p Fg(\()p Fe(s)1730 40 y Fk(1)1745 36
y Fe(;)6 b(a)p Fg(\))11 b Ff(!)1493 78 y Fe(k)g(a)g(s)1573
82 y Fk(1)1020 150 y Fr(Note)g(that)f(these)g(de\256nitions)f(ar)o(e)h(not)g
(r)o(ecursive;)g(the)g(constructor)1020 191 y(class)20 b(system)h
(automatically)f(infers)h(that)g(the)h Fq(bind)f Fr(and)g Fq(unit)1020
233 y Fr(appearing)10 b(on)g(the)g(right)g(ar)o(e)g(for)h(monad)f
Fq(m)p Fr(.)1076 274 y(Next,)h(we)g(de\256ne)e(\252)p Fq(StateT)h(s)p
Fr(\272)f(as)h(a)g(monad)g(transformer:)1039 341 y Fh(instance)f
Fg(\()p Fq(Monad)g Fe(m;)17 b Fq(Monad)9 b Fg(\()p Fq(StateT)h
Fe(s)g(m)p Fg(\)\))g Ff(\))1412 383 y Fq(MonadT)f Fg(\()p Fq(StateT)h
Fe(s)p Fg(\))h Fe(m)f Fh(where)1095 425 y Fq(lift)i Fe(m)37
b Fg(=)g Ff(n)p Fe(s)11 b Ff(!)g Fe(m)f Fr(`)p Fq(bind)q Fr(`)g
Ff(n)p Fe(x)h Ff(!)g Fq(unit)g Fg(\()p Fe(s;)6 b(x)p Fg(\))1020
497 y Fr(Note)21 b(that)g Fq(lift)i Fr(simply)d(runs)g Fq(m)h
Fr(in)f(the)h(new)g(context,)j(while)1020 539 y(pr)o(eserving)10
b(the)g(state.)1076 580 y(Finally)l(,)g(as)g(explained)g(earlier)m(,)g(a)g
(state)g(monad)h(must)f(support)1020 622 y(the)j(operation)h
Fq(update)p Fr(.)23 b(T)m(o)13 b(keep)g(things)g(modular)m(,)h(we)f(de\256ne)
g(a)1020 663 y(class)c(of)i(state)g(monads:)1039 726 y Fh(class)e
Fq(Monad)g Fe(m)i Ff(\))g Fq(StateMonad)e Fe(s)h(m)g Fh(where)1095
767 y Fq(update)36 b Fr(::)i Fg(\()p Fe(s)10 b Ff(!)h Fe(s)p
Fg(\))g Ff(!)g Fe(m)f(s)1020 840 y Fr(In)j(particular)m(,)g(\252)p
Fq(StateT)g(s)p Fr(\272)g(transforms)g(any)g(monad)g(into)h(a)g(state)1020
882 y(monad,)f(wher)o(e)g(\252)p Fq(update)e(f)c Fr(\272)12
b(applies)h Fq(f)h Fr(to)f(the)g(state,)g(and)f(r)o(eturns)1020
923 y(the)e(old)h(state:)1039 985 y Fh(instance)e Fq(Monad)g
Fe(m)i Ff(\))g Fq(StateMonad)e Fe(s)h Fg(\()p Fq(StateT)g Fe(s)g(m)p
Fg(\))h Fh(where)1095 1027 y Fq(update)e Fe(f)41 b Fg(=)c Ff(n)p
Fe(s)11 b Ff(!)g Fq(unit)g Fg(\()p Fe(f)j(s;)6 b(s)p Fg(\))1020
1127 y Fs(7.2)41 b(Environment)9 b(Monad)g(T)m(ransfo)o(rmer)1020
1195 y Fr(\252)p Fq(EnvT)d(r)p Fr(\272)g(transforms)h(any)g(monad)f(into)i
(an)e(envir)o(onment)h(monad.)1020 1236 y(The)13 b(de\256nition)g(of)h
Fq(bind)g Fr(tells)f(us)g(that)h(two)g(subsequent)e(compu-)1020
1278 y(tation)i(steps)f(run)g(under)f(the)h(same)g(envir)o(onment)g
Fq(r)p Fr(.)24 b(\(Compar)o(e)1020 1319 y(this)15 b(with)g(the)h(state)f
(monad,)h(wher)o(e)f(the)h(second)e(computation)1020 1361 y(is)h(run)e(in)h
(the)h(state)f(r)o(eturned)g(by)g(the)h(\256rst)f(computation.\))28
b Fq(Lift)1020 1402 y Fr(just)9 b(performs)h(a)f(computation)g(\320)h(which)f
(cannot)g(depend)g(on)g(the)1020 1444 y(envir)o(onment)g(\320)h(and)e(ignor)o
(es)h(the)h(envir)o(onment.)k Fq(InEnv)9 b Fr(ignor)o(es)1020
1485 y(the)g(envir)o(onment)f(carried)f(inside)h(the)h(monad,)g(and)f
(performs)h(the)1020 1527 y(computation)h(in)g(a)g(given)g(envir)o(onment.)
1039 1596 y Fh(type)g Fq(EnvT)f Fe(r)j(m)e(a)38 b Fg(=)f Fe(r)12
b Ff(!)f Fe(m)g(a)1039 1678 y Fh(instance)e Fq(Monad)g Fe(m)i
Ff(\))g Fq(Monad)e Fg(\()p Fq(EnvT)h Fe(r)h(m)p Fg(\))g Fh(where)1095
1719 y Fq(unit)g Fe(a)106 b Fg(=)37 b Ff(n)p Fe(r)12 b Ff(!)f
Fq(unit)g Fe(a)1095 1761 y(m)f Fr(`)p Fq(bind)p Fr(`)h Fe(k)39
b Fg(=)e Ff(n)p Fe(r)12 b Ff(!)f Fe(m)f(r)i Fr(`)p Fq(bind)q
Fr(`)f Ff(n)p Fe(a)g Ff(!)g Fe(k)g(a)g(r)1039 1842 y Fh(instance)e
Fg(\()p Fq(Monad)g Fe(m;)17 b Fq(Monad)9 b Fg(\()p Fq(EnvT)g
Fe(r)j(m)p Fg(\)\))e Ff(\))1412 1884 y Fq(MonadT)f Fg(\()p
Fq(EnvT)h Fe(r)q Fg(\))h Fe(m)f Fh(where)1095 1925 y Fq(lift)i
Fe(m)37 b Fg(=)g Ff(n)p Fe(r)12 b Ff(!)f Fe(m)1039 2008 y Fh(class)e
Fq(Monad)g Fe(m)i Ff(\))g Fq(EnvMonad)d(env)i Fe(m)g Fh(where)1095
2050 y Fq(inEnv)39 b Fr(::)f Fq(env)9 b Ff(!)i Fe(m)g(a)g Ff(!)g
Fe(m)f(a)1095 2091 y Fq(rdEnv)36 b Fr(::)i Fe(m)10 b Fq(env)1039
2173 y Fh(instance)f Fq(Monad)g Fe(m)i Ff(\))g Fq(EnvMonad)e
Fe(r)i Fg(\()p Fq(EnvT)f Fe(r)i(m)p Fg(\))e Fh(where)1095 2215
y Fq(inEnv)g Fe(r)h(m)38 b Fg(=)f Ff(n)p 1387 2215 12 2 v 24
w(!)11 b Fe(m)f(r)1095 2256 y Fq(rdEnv)107 b Fg(=)37 b Ff(n)p
Fe(r)12 b Ff(!)f Fq(unit)g Fe(r)1020 2355 y Fs(7.3)41 b(Erro)o(r)9
b(Monad)g(T)m(ransfo)o(rmer)1020 2423 y Fr(Monad)14 b Fq(Err)o(or)e
Fr(completes)i(a)g(series)f(of)i(computations)e(if)i(all)e(suc-)1020
2465 y(ceed,)20 b(or)f(aborts)f(as)g(soon)h(as)g(an)f(err)o(or)g(occurs.)38
b(The)19 b(monad)1020 2506 y(transformer)8 b Fq(Err)o(orT)e
Fr(transforms)i(a)g(monad)g(into)g(an)g(err)o(or)g(monad.)1039
2568 y Fh(data)i Fq(Err)o(or)e Fe(a)107 b Fg(=)38 b Fq(Ok)10
b Fe(a)g Ff(j)g Fq(Err)o(or)f(String)1039 2610 y Fh(type)h
Fq(Err)o(orT)e Fe(m)j(a)37 b Fg(=)h Fe(m)10 b Fg(\()p Fq(Err)o(or)e
Fe(a)p Fg(\))961 2747 y Fr(7)p eop
%%Page: 8 8
8 7 bop -57 -47 a Fh(instance)9 b Fq(Monad)h Fe(m)g Ff(\))h
Fq(Monad)e Fg(\()p Fq(Err)o(orT)g Fe(m)p Fg(\))h Fh(where)-1
-5 y Fq(unit)137 b Fg(=)37 b Fq(unit)9 b Ff(\001)f Fq(Ok)-1
36 y Fe(m)i Fr(`)p Fq(bind)q Fr(`)g Fe(k)39 b Fg(=)74 78 y
Fe(m)10 b Fr(`)p Fq(bind)p Fr(`)h Ff(n)p Fe(a)g Ff(!)74 119
y Fh(case)e Fe(a)h Fh(of)130 161 y Fg(\()p Fq(Ok)g Fe(x)p Fg(\))114
b Ff(!)38 b Fe(k)11 b(x)130 202 y Fg(\()p Fq(Err)o(or)d(msg)p
Fg(\))37 b Ff(!)h Fq(unit)10 b Fg(\()p Fq(Err)o(or)f(msg)o
Fg(\))-57 284 y Fh(instance)g Fg(\()p Fq(Monad)g Fe(m;)17 b
Fq(Monad)9 b Fg(\()p Fq(Err)o(orT)g Fe(m)p Fg(\)\))h Ff(\))316
325 y Fq(MonadT)g(Err)o(orT)e Fe(m)i Fh(where)-1 367 y Fq(lift)39
b Fg(=)e Fq(map)10 b(unit)-57 449 y Fh(class)f Fq(Monad)g Fe(m)i
Ff(\))g Fq(ErrMonad)d Fe(m)i Fh(where)-1 491 y Fq(err)36 b
Fr(::)i Fq(String)10 b Ff(!)h Fe(m)f(a)-57 574 y Fh(instance)f
Fq(Monad)h Fe(m)g Ff(\))h Fq(ErrMonad)d Fg(\()p Fq(Err)o(orT)h
Fe(m)p Fg(\))h Fh(where)-1 615 y Fq(err)36 b Fg(=)h Fq(unit)9
b Ff(\001)f Fq(Err)o(or)-76 715 y Fs(7.4)41 b(Continuation)8
b(Monad)h(T)m(ransfo)o(rmer)-76 783 y Fr(W)m(e)h(de\256ne)g(the)g
(continuation)f(monad)h(transformer)g(as:)-57 852 y Fh(type)g
Fq(ContT)g(ans)f Fe(m)h(a)38 b Fg(=)f(\()p Fe(a)11 b Ff(!)g
Fe(m)f Fq(ans)o Fg(\))h Ff(!)g Fe(m)f Fq(ans)-57 933 y Fh(instance)f
Fq(Monad)h Fe(m)g Ff(\))h Fq(Monad)e Fg(\()p Fq(ContT)h(ans)g
Fe(m)p Fg(\))g Fh(where)-1 975 y Fq(unit)h Fe(x)105 b Fg(=)38
b Ff(n)p Fe(k)12 b Ff(!)f Fe(k)g(x)-1 1016 y(m)f Fr(`)p Fq(bind)q
Fr(`)g Fe(f)41 b Fg(=)d Ff(n)p Fe(k)12 b Ff(!)f Fe(m)f Fg(\()p
Ff(n)p Fe(a)h Ff(!)g Fe(f)j(a)d(k)q Fg(\))-76 1096 y Fq(ContT)16
b Fr(intr)o(oduces)f(an)h(additional)f(continuation)g(ar)o(gument)g(\(of)-76
1137 y(type)d(\252)p Fq(a)e Ff(!)i Fq(m)f(ans)p Fr(\272\),)g(and)g(by)f(the)h
(above)g(de\256nitions)f(of)j Fq(unit)e Fr(and)-76 1179 y Fq(bind)p
Fr(,)k(all)d(computations)i(in)e(monad)h(\252)p Fq(ContT)g(ans)f(m)p
Fr(\272)h(ar)o(e)g(carried)-76 1220 y(out)e(in)f(a)g(continuation)f(passing)h
(style.)-20 1262 y Fq(Lift)i Fr(for)g(\252)p Fq(Cont)f(ans)f(m)p
Fr(\272)h(turns)f(out)i(to)f(be)g(the)g(same)g(as)f Fq(bind)i
Fr(for)-76 1303 y Fq(m)p Fr(.)27 b(\(It)15 b(is)f(easy)g(to)h(see)f(this)g
(fr)o(om)h(the)f(type)h(signatur)o(e.\))26 b(\252)p Fq(Callcc)-76
1345 y(f)7 b Fr(\272)15 b(invokes)g(the)g(computation)g(in)g
Fq(f)p Fr(,)j(passing)c(it)h(a)g(continuation)-76 1386 y(that)k(once)f
(applied,)j(thr)o(ows)e(away)f(the)h(curr)o(ent)e(continuation)-76
1428 y(\(denoted)11 b(as)f(\252)p 149 1428 12 2 v 13 w(\272\))g(and)g
(invokes)g(the)g(captur)o(ed)g(continuation)f Fq(k)p Fr(.)-57
1499 y Fh(instance)g Fg(\()p Fq(Monad)g Fe(m;)17 b Fq(Monad)9
b Fg(\()p Fq(ContT)h(ans)f Fe(m)p Fg(\)\))i Ff(\))316 1541
y Fq(MonadT)f Fg(\()p Fq(ContT)f(ans)o Fg(\))i Fe(m)f Fh(where)-1
1582 y Fq(lift)39 b Fg(=)e Fq(bind)-57 1665 y Fh(class)9 b
Fq(Monad)g Fe(m)i Ff(\))g Fq(ContMonad)e Fe(m)h Fh(where)-1
1707 y Fq(callcc)38 b Fr(::)g Fg(\(\()p Fe(a)11 b Ff(!)g Fe(m)f(b)p
Fg(\))h Ff(!)h Fe(m)e(a)p Fg(\))h Ff(!)g Fe(m)f(a)-57 1789
y Fh(instance)f Fq(Monad)h Fe(m)g Ff(\))h Fq(ContMonad)e Fg(\()p
Fq(ContT)h(ans)f Fe(m)p Fg(\))h Fh(where)-1 1831 y Fq(callcc)h
Fe(f)41 b Fg(=)d Ff(n)p Fe(k)11 b Ff(!)h Fe(f)i Fg(\()p Ff(n)p
Fe(a)d Ff(!)g(n)p 488 1831 V 24 w(!)g Fe(k)h(a)p Fg(\))e Fe(k)-76
1931 y Fs(7.5)41 b(The)11 b(List)e(Monad)-76 1999 y Fr(Jones)15
b(and)e(Duponcheel)h([10)o(])h(have)f(shown)g(that)g(lists)g(compose)-76
2040 y(with)e(special)g(kinds)f(of)i(monads)f(called)f Fq(commutative)h
(monads)p Fr(.)19 b(It)-76 2082 y(is)9 b(not)g(clear)m(,)f(however)m(,)i(if)f
(lists)f(compose)h(with)g(arbitrary)e(monads.)-76 2123 y(Since)g(many)g
(useful)g(monads)g(\(e.g.)15 b(state,)8 b(err)o(or)g(and)f(continuation)-76
2165 y(monads\))h(ar)o(e)f(not)h(commutative,)g(we)g(cannot)f(de\256ne)g(a)g
(list)h(monad)-76 2206 y(transformer)13 b(\320)i(one)e(which)g(adds)g(the)h
(operation)g Fq(mer)o(ge)f Fr(to)h(any)-76 2248 y(monad.)-20
2289 y(Fortunately)l(,)21 b(every)f(other)f(monad)h(transformer)f(we)h(have)
-76 2331 y(consider)o(ed)14 b(in)g(this)g(paper)h(takes)e(arbitrary)g
(monads.)27 b(W)m(e)14 b(thus)-76 2372 y(use)e(lists)g(as)f(the)h
Fq(base)g Fr(monad,)g(upon)h(which)e(other)h(transformers)-76
2414 y(can)e(be)f(applied.)-57 2485 y Fh(instance)g Fq(Monad)h(List)g
Fh(where)-1 2527 y Fq(unit)h Fe(x)186 b Fg(=)37 b([)p Fe(x)p
Fg(])-1 2568 y([)10 b(])g Fr(`)p Fq(bind)p Fr(`)h Fe(k)123
b Fg(=)37 b([)10 b(])-1 2610 y(\()p Fe(x)g Fr(:)h Fq(xs)o Fg(\))g
Fr(`)p Fq(bind)p Fr(`)g Fe(k)39 b Fg(=)e Fe(k)11 b(x)f Fr(++)g
Fg(\()p Fq(xs)g Fr(`)p Fq(bind)p Fr(`)h Fe(k)q Fg(\))1039 -47
y Fh(class)e Fq(Monad)g Fe(m)i Ff(\))g Fq(ListMonad)e Fe(m)h
Fh(where)1095 -5 y Fq(mer)o(ge)36 b Fr(::)i Fg([)p Fe(m)10
b(a)p Fg(])g Ff(!)h Fe(m)g(a)1039 59 y Fh(instance)e Fq(ListMonad)h(List)g
Fh(where)1095 101 y Fq(mer)o(ge)36 b Fg(=)h Fq(concat)1020
202 y Fs(8)k(Lifting)8 b(Op)q(erations)1020 284 y Fr(W)m(e)17
b(have)g(intr)o(oduced)g(monad)g(transformers)g(that)g(add)g(useful)1020
325 y(operations)d(to)f(a)g(given)g(monad,)h(but)f(have)f(not)i(addr)o(essed)
e(how)1020 367 y(these)21 b(operations)h(can)e(be)h(carried)f(thr)o(ough)h
(other)g(layers)f(of)1020 408 y(monad)15 b(transformers,)g(or)h(equivalently)
l(,)e(how)h(a)g(monad)g(trans-)1020 450 y(former)c(lifts)f(existing)g
(operations)h(within)f(a)g(monad.)1076 491 y(Lifting)18 b(an)g(operation)h
Fq(f)k Fr(in)18 b(monad)h Fq(m)f Fr(thr)o(ough)g(a)h(monad)1020
533 y(transformer)13 b Fq(t)i Fr(r)o(esults)e(in)g(an)g(operation)i(whose)f
(type)g(signatur)o(e)1020 574 y(can)g(be)h(derived)f(by)h(substituting)e(all)
i(occurr)o(ences)e(of)j Fq(m)f Fr(in)f(the)1020 616 y(type)e(of)h
Fq(f)f Fr(with)g(\252)p Fq(t)h(m)p Fr(\272.)19 b(For)12 b(example,)h(lifting)
e(\252)p Fq(inEnv)g(::)19 b(r)11 b Ff(!)i Fq(m)f(a)1020 657
y Ff(!)f Fq(m)f(a)p Fr(\272)g(thr)o(ough)f Fq(t)i Fr(r)o(esults)e(in)h(an)g
(operation)h(with)f(type)g(\252)p Fq(r)g Ff(!)h Fq(t)f(m)1020
699 y(a)g Ff(!)h Fq(t)g(m)f(a)p Fr(.\272)1020 740 y(Given)g(the)g(types)g(of)
h(operations)g(in)f(monad)g Fq(m)p Fr(:)1244 803 y Fe(\034)42
b Fr(::)p Fg(=)c Fe(A)110 b Fr(\(type)11 b(constants\))1322
845 y Ff(j)56 b Fe(a)119 b Fr(\(type)11 b(variables\))1322
886 y Ff(j)56 b Fe(\034)15 b Ff(!)c Fe(\034)41 b Fr(\(function)11
b(types\))1322 928 y Ff(j)56 b Fg(\()p Fe(\034)r(;)6 b(\034)t
Fg(\))52 b Fr(\(pr)o(oduct)11 b(types\))1322 969 y Ff(j)56
b Fe(m)10 b(\034)78 b Fr(\(monad)11 b(types\))1020 1033 y Ff(de)1054
1037 y Fc(t)1079 1033 y Fr(is)f(the)g(mapping)g(of)h(types)g(acr)o(oss)f(the)
g(monad)g(transformer)g Fq(t)p Fr(:)1271 1095 y Ff(d)p Fe(A)p
Ff(e)1334 1099 y Fc(t)1479 1095 y Fg(=)37 b Fe(A)1271 1137
y Ff(d)p Fe(a)p Ff(e)1325 1141 y Fc(t)1479 1137 y Fg(=)g Fe(a)1271
1178 y Ff(d)p Fe(\034)1305 1182 y Fk(1)1330 1178 y Ff(!)11
b Fe(\034)1396 1182 y Fk(2)1411 1178 y Ff(e)1428 1182 y Fc(t)1479
1178 y Fg(=)37 b Ff(d)p Fe(\034)1580 1182 y Fk(1)1595 1178
y Ff(e)1612 1182 y Fc(t)1637 1178 y Ff(!)11 b(d)p Fe(\034)1720
1182 y Fk(2)1734 1178 y Ff(e)1751 1182 y Fc(t)1271 1220 y Ff(d)p
Fg(\()p Fe(\034)1320 1224 y Fk(1)1335 1220 y Fe(;)6 b(\034)1369
1224 y Fk(2)1383 1220 y Fg(\))p Ff(e)1415 1224 y Fc(t)1479
1220 y Fg(=)37 b(\()p Ff(d)p Fe(\034)1595 1224 y Fk(1)1610
1220 y Ff(e)1627 1224 y Fc(t)1641 1220 y Fe(;)6 b Ff(d)p Fe(\034)1692
1224 y Fk(2)1706 1220 y Ff(e)1723 1224 y Fc(t)1737 1220 y Fg(\))1271
1261 y Ff(d)p Fe(m)k(\034)t Ff(e)1370 1265 y Fc(t)1479 1261
y Fg(=)37 b Fe(t)11 b(m)f Ff(d)p Fe(\034)t Ff(e)1670 1265 y
Fc(t)1076 1324 y Fr(Moggi)e([15])g(studied)f(the)g(pr)o(oblem)h(of)h(lifting)
e(under)g(a)g(categor)o(-)1020 1365 y(ical)i(context.)15 b(The)9
b(objective)g(was)h(to)g(identify)g(liftable)f(operations)1020
1407 y(fr)o(om)g(their)e(type)i(signatur)o(es.)j(Unfortunately)l(,)c(many)f
(useful)g(oper)o(-)1020 1448 y(ations)j(such)f(as)h Fq(mer)o(ge)p
Fr(,)g Fq(inEnv)g Fr(and)f Fq(callcc)j Fr(failed)e(to)h(meet)f(Moggi's)1020
1490 y(criteria,)f(and)h(wer)o(e)g(left)h(unsolved.)1076 1532
y(W)m(e)f(individually)e(consider)h(how)h(to)h(lift)f(these)g(dif)o(\256cult)
f(cases.)1020 1573 y(This)j(allows)g(us)g(to)h(make)f(use)g(of)h(their)f
(de\256nitions)g(\(rather)g(than)1020 1615 y(just)d(the)g(types\),)h(and)f
(\256nd)f(ways)h(to)h(lift)g(them)f(thr)o(ough)g(all)g(monad)1020
1656 y(transformers)h(studied)f(so)i(far)m(.)1076 1698 y(This)17
b(is)h(exactly)g(wher)o(e)f(monad)h(transformers)f(pr)o(ovide)i(us)1020
1739 y(with)f(an)f(opportunity)h(to)h(study)e(how)h(various)f(pr)o(ogramming)
1020 1781 y(language)8 b(featur)o(es)i(interact.)15 b(The)10
b(easy-to-lift)h(cases)e(corr)o(espond)1020 1822 y(to)18 b(featur)o(es)f
(that)g(ar)o(e)g(independent)f(in)h(natur)o(e,)h(and)f(the)g(mor)o(e)1020
1864 y(involved)8 b(cases)f(r)o(equir)o(e)h(a)g(deeper)g(analysis)f(of)i
(monad)f(structur)o(es)1020 1905 y(in)i(or)o(der)g(to)h(clarify)f(the)g
(semantics.)1076 1947 y(An)d(unfortunate)f(consequence)f(of)i(our)g(appr)o
(oach)g(is)f(that)h(as)f(we)1020 1988 y(consider)11 b(mor)o(e)h(monad)f
(transformers,)g(the)h(number)e(of)i(possible)1020 2030 y(liftings)i(gr)o
(ows)i(quadratically)l(.)25 b(It)15 b(seems,)g(however)m(,)i(that)e(ther)o(e)
1020 2071 y(ar)o(e)j(not)h(too)h(many)d(dif)o(fer)o(ent)j(kinds)d(of)j(monad)
e(transformers)1020 2113 y(\(although)13 b(ther)o(e)g(may)f(be)h(many)g
Fq(instances)f Fr(of)i(the)f(same)g(monad)1020 2154 y(transformer)20
b(such)f(as)h Fq(StateT)p Fr(\).)h(What)g(we)f(intr)o(oduced)g(so)g(far)1020
2196 y(ar)o(e)14 b(able)g(to)h(model)g(almost)f(all)g(commonly)h(known)f
(featur)o(es)g(of)1020 2237 y(sequential)f(languages.)25 b(Even)14
b(so,)i(not)f(all)f(of)h(them)f(ar)o(e)g(strictly)1020 2279
y(necessary)l(.)j(The)11 b(envir)o(onment,)h(for)g(example,)h(can)d(be)i
(simulated)1020 2320 y(using)d(a)h(state)g(monad:)1020 2377
y Fh(instance)f Fg(\()p Fq(Monad)h Fe(m;)c Fq(StateMonad)j
Fe(r)i(m)p Fg(\))g Ff(\))1412 2419 y Fq(EnvMonad)e Fe(r)j(m)e
Fh(where)1057 2460 y Fq(inEnv)g Fe(r)i(m)37 b Fg(=)g Fq(update)9
b Fg(\()p Ff(n)p 1476 2460 V 25 w(!)i Fe(r)q Fg(\))f Fr(`)p
Fq(bind)q Fr(`)h Ff(n)p Fe(o)f Ff(!)1328 2502 y Fe(m)h Fr(`)p
Fq(bind)p Fr(`)g Ff(n)p Fe(v)h Ff(!)1328 2544 y Fq(update)d
Fg(\()p Ff(n)p 1476 2544 V 25 w(!)i Fe(o)p Fg(\))f Fr(`)p Fq(bind)p
Fr(`)h Ff(n)p 1711 2544 V 24 w(!)1328 2585 y Fq(unit)g Fe(v)1057
2627 y Fq(rdEnv)107 b Fg(=)37 b Fq(update)9 b(id)961 2747 y
Fr(8)p eop
%%Page: 9 9
9 8 bop -76 -34 a Fr(Also,)12 b(as)f(is)f(well)h(known,)h(err)o(or)f(r)o
(eporting)g(can)f(be)h(implemented)-76 7 y(using)e Fq(callcc)p
Fr(.)-76 106 y Fs(8.1)41 b(Co)o(rrectness)10 b(Criteria)-76
173 y Fr(The)j(basic)e(r)o(equir)o(ement)h(of)i(lifting)f(is)f(that)h(any)f
(pr)o(ogram)h(which)-76 215 y(does)f(not)g(use)f(the)h(added)f(featur)o(es)g
(should)g(behave)g(in)g(the)h(same)-76 256 y(way)c(after)h(a)f(monad)g
(transformer)f(is)i(applied.)14 b(The)8 b(monad)g(trans-)-76
298 y(former)k(laws)f(intr)o(oduced)f(in)h(Section)g(7)g(ar)o(e)g(meant)f(to)
i(guarantee)-76 339 y(such)e(pr)o(operty)h(for)g(lifting)g(a)f(single)g
(computation.)15 b(Most)d(monad)-76 381 y(operations,)23 b(however)m(,)f
(have)d(mor)o(e)h(general)e(types.)43 b(T)m(o)19 b(deal)-76
422 y(with)8 b(operations)h(on)f(arbitrary)f(types,)i(we)f(extend)h(Moggi's)f
(corr)o(e-)-76 464 y(sponding)j(categorical)e(appr)o(oach,)i(and)f(de\256ne)g
Ff(L)670 468 y Fc(\034)700 464 y Fr(as)h(the)f Fq(natural)-76
506 y(lifting)k Fr(of)f(operations)f(of)h(type)g Fe(\034)j
Fr(along)c(the)g(monad)g(transformer)-76 547 y Fq(t)p Fr(:)80
581 y Ff(L)106 585 y Fc(\034)239 581 y Fr(::)44 b Fe(\034)14
b Ff(!)d(d)p Fe(\034)t Ff(e)436 585 y Fc(t)80 664 y Ff(L)106
668 y Fc(A)233 664 y Fg(=)38 b Fq(id)386 b Fg(\()p Fr(1)p Fg(\))80
705 y Ff(L)106 709 y Fc(a)233 705 y Fg(=)38 b Fq(id)386 b Fg(\()p
Fr(2)p Fg(\))80 747 y Ff(L)106 751 y Fc(\034)120 757 y Fj(1)133
751 y Fd(!)p Fc(\034)177 757 y Fj(2)233 747 y Fg(=)38 b Ff(n)p
Fe(f)14 b Ff(!)d Fe(f)425 731 y Fd(0)446 747 y Fq(such)f(that)375
789 y Fe(f)398 774 y Fd(0)418 789 y Ff(\001)e(L)463 793 y Fc(\034)477
799 y Fj(1)503 789 y Fg(=)j Ff(L)570 793 y Fc(\034)584 799
y Fj(2)608 789 y Ff(\001)d Fe(f)70 b Fg(\()p Fr(3)p Fg(\))80
831 y Ff(L)106 837 y Fb(\()p Fc(\034)132 843 y Fj(1)145 837
y Fc(;\034)168 843 y Fj(2)182 837 y Fb(\))233 831 y Fg(=)38
b Ff(n)p Fg(\()p Fe(a;)6 b(b)p Fg(\))11 b Ff(!)g Fg(\()p Ff(L)504
835 y Fc(\034)518 841 y Fj(1)544 831 y Fe(a;)6 b Ff(L)607 835
y Fc(\034)621 841 y Fj(2)647 831 y Fe(b)p Fg(\))38 b(\()p Fr(4)p
Fg(\))80 872 y Ff(L)106 876 y Fc(m)11 b(\034)233 872 y Fg(=)38
b Fq(lift)10 b Ff(\001)e Fg(\()p Fq(map)h Ff(L)487 876 y Fc(\034)507
872 y Fg(\))194 b(\()p Fr(5)p Fg(\))-20 938 y Fr(Constant)9
b(types)f(\(such)g(as)f Fq(Integer)p Fr(\))h(and)f(type)i(variables)e(do)h
(not)-76 980 y(depend)13 b(on)h(any)e(particular)g(monad.)23
b(\(See)13 b(cases)f(1)h(and)g(2.\))23 b(On)-76 1021 y(the)15
b(other)g(hand,)g(we)g(expect)g(a)f(lifted)h(function,)h(when)e(applied)-76
1063 y(to)h(a)g(value)e(lifted)i(fr)o(om)h(the)e(domain)g(of)i(the)e
(original)g(function,)-76 1104 y(to)k(r)o(eturn)e(the)g(lifting)h(of)h(the)e
(r)o(esult)h(of)g(applying)g(the)f(original)-76 1146 y(function)11
b(to)h(the)g(unlifted)e(value.)18 b(This)11 b(r)o(elationship)g(is)g(pr)o
(ecisely)-76 1188 y(captur)o(ed)f(by)g(equation)g(3,)h(which)f(corr)o
(esponds)g(to)h(the)g(following)-76 1229 y(commuting)f(diagram:)227
1339 y Ff(d)p Fe(\034)261 1343 y Fk(1)275 1339 y Ff(e)292 1343
y Fc(t)538 1339 y Ff(d)p Fe(\034)572 1343 y Fk(2)587 1339 y
Ff(e)604 1343 y Fc(t)251 1546 y Fe(\034)268 1550 y Fk(1)562
1546 y Fe(\034)579 1550 y Fk(2)p 319 1327 207 2 v 484 1326
a Fa(-)405 1311 y Fe(f)428 1295 y Fd(0)p 295 1535 255 2 v 508
1534 a Fa(-)411 1568 y Fe(f)p 266 1514 2 149 v 267 1406 a Fa(6)203
1443 y Ff(L)229 1447 y Fc(\034)243 1453 y Fj(1)p 577 1514 V
578 1406 a Fa(6)586 1443 y Ff(L)612 1447 y Fc(\034)626 1453
y Fj(2)-76 1644 y Fr(The)20 b(lifting)g(of)h(tuples)e(is)h(straightforwar)o
(d.)44 b(Finally)l(,)21 b(the)f Fq(lift)-76 1686 y Fr(operator)c(come)f(with)
g(the)g(monad)f(transformer)h(lifts)g(computa-)-76 1727 y(tions)g(expr)o
(essed)g(in)g(monad)f(types.)29 b(Note)15 b(that)g Ff(L)707
1731 y Fc(\034)742 1727 y Fr(is)f(mapped)-76 1769 y(to)h(the)f(r)o(esult)f
(of)i(the)f(computation,)i(which)d(may)g(involve)h(other)-76
1810 y(computations.)-20 1852 y(Note)f(that)g(the)f(above)g(does)h
Fq(not)f Fr(pr)o(ovide)h(a)g(Gofer)f(de\256nition)-76 1893
y(for)g(an)e(overloaded)g(lifting)h(function)f Ff(L)p Fr(.)17
b(The)10 b(\252such)g(that\272)g(clause)-76 1935 y(in)17 b(the)h(thir)o(d)f
(equation)f(speci\256es)h(a)g(constraint,)h(rather)f(than)g(a)-76
1976 y(de\256nition)12 b(of)i Fe(f)167 1960 y Fd(0)177 1976
y Fr(.)22 b(In)12 b(practice,)h(we)g(\256rst)f(\256nd)g(out)g(by)g(hand)g
(how)-76 2018 y(to)i(lift)g(an)f(operation)g(thr)o(ough)g(a)g(certain)f(\(or)
i(a)f(class)f(of\))j(monad)-76 2059 y(transformer)m(,)22 b(and)d(then)g(use)f
(the)i(above)f(equations)g(to)h(verify)-76 2101 y(that)14 b(such)f(a)g
(lifting)h(is)g(indeed)f(natural.)24 b(Generally)12 b(we)i(r)o(equir)o(e)-76
2142 y(operations)d(to)g(be)f(lifted)h(naturally)e(\320)i(although)e(as)h
(will)h(be)f(seen,)-76 2184 y(certain)e(unnatural)f(liftings)h(change)g(the)h
(semantics)f(in)g(inter)o(esting)-76 2225 y(ways.)-76 2324
y Fs(8.2)41 b(Easy)9 b(Cases)-76 2391 y Fq(Err)15 b Fr(and)f
Fq(update)h Fr(ar)o(e)g(handled)f(by)h Fq(lift)p Fr(,)k(wher)o(eas)14
b Fq(mer)o(ge)h Fr(bene\256ts)-76 2433 y(fr)o(om)c Fq(List)g
Fr(being)e(the)h(base)g(monad.)-57 2507 y Fh(instance)f Fg(\()p
Fq(ErrMonad)f Fe(m;)17 b Fq(MonadT)9 b Fe(t)h(m)p Fg(\))g Ff(\))316
2548 y Fq(ErrMonad)f Fg(\()p Fe(t)h(m)p Fg(\))g Fh(where)-1
2590 y Fq(err)36 b Fg(=)h Fq(lift)10 b Ff(\001)e Fq(err)1039
-47 y Fh(instance)h Fg(\()p Fq(StateMonad)g Fe(m;)16 b Fq(MonadT)10
b Fe(t)g(m)p Fg(\))g Ff(\))1412 -5 y Fq(StateMonad)f Fg(\()p
Fe(t)i(m)p Fg(\))f Fh(where)1095 36 y Fq(update)36 b Fg(=)h
Fq(lift)10 b Ff(\001)e Fq(update)1039 121 y Fh(instance)h Fq(MonadT)g
Fe(t)i Fq(List)f Ff(\))h Fq(ListMonad)f Fg(\()p Fe(t)g Fq(List)p
Fg(\))g Fh(where)1095 163 y Fq(mer)o(ge)36 b Fg(=)h Fq(join)9
b Ff(\001)f Fq(lift)1020 264 y Fs(8.3)41 b(Lifting)8 b Fq(Callcc)1020
332 y Fr(The)18 b(following)i(lifting)e(of)i Fq(callcc)g Fr(thr)o(ough)e
Fq(EnvT)g Fr(discar)o(ds)f(the)1020 373 y Fq(curr)o(ent)c Fr(envir)o(onment)g
Fq(r)q(')h Fr(upon)f(invoking)g(the)h(captur)o(ed)e(contin-)1020
415 y(uation)g Fq(k)p Fr(.)21 b(The)13 b(execution)f(will)g(continue)g(in)g
(the)g(envir)o(onment)h Fq(r)1020 456 y Fr(captur)o(ed)d(when)g
Fq(callcc)h Fr(was)f(\256rst)g(invoked.)1039 561 y Fh(instance)f
Fg(\()p Fq(MonadT)g Fg(\()p Fe(E)r(nv)q(T)17 b(r)q Fg(\))10
b Fe(m;)17 b Fq(ContMonad)9 b Fe(m)p Fg(\))h Ff(\))1412 603
y Fq(ContMonad)f Fg(\()p Fq(EnvT)h Fe(r)i(m)p Fg(\))e Fh(where)1039
644 y Fr(-)h(-)19 b Fq(callcc)77 b Fr(::)43 b Fg(\(\()p Fe(a)11
b Ff(!)g Fe(r)h Ff(!)f Fe(m)g(b)p Fg(\))g Ff(!)g Fe(r)h Ff(!)f
Fe(m)f(a)p Fg(\))h Ff(!)g Fe(r)h Ff(!)f Fe(m)f(a)1093 686 y
Fq(callcc)h Fe(f)41 b Fg(=)c Ff(n)p Fe(r)13 b Ff(!)e Fq(callcc)g
Fg(\()p Ff(n)p Fe(k)h Ff(!)f Fe(f)j Fg(\()p Ff(n)p Fe(a)d Ff(!)g(n)p
Fe(r)1803 670 y Fd(0)1826 686 y Ff(!)g Fe(k)g(a)p Fg(\))g Fe(r)q
Fg(\))1076 760 y Fr(The)h(Appendix)h(shows)f(that)g(if)g(we)g(\257ip)h(the)f
(or)o(der)g(of)h(monad)1020 801 y(transformers)e(and)g(apply)h
Fq(ContT)f Fr(to)i(\252)p Fq(EnvT)d(env)h(m)p Fr(\272)h(\320)g(in)f(which)
1020 843 y(case)19 b(no)h(lifting)f(of)i Fq(callcc)g Fr(will)e(be)h
(necessary)e(\320)i(the)g(curr)o(ent)1020 884 y(envir)o(onment)15
b(will)g(be)g(passed)g(to)g(the)h(continuation.)28 b(\(W)m(e)16
b(will)1020 926 y(see)c(how)g(to)h(\256x)f(this)g(by)g(car)o(efully)e(r)o
(ecovering)i(the)g(envir)o(onment)1020 967 y(when)e(we)g(lift)h
Fq(inEnv)f Fr(in)g(a)g(moment.\))1076 1009 y(In)h(general)f(we)i(can)e(swap)i
(the)f(or)o(der)h(of)g(some)g(monad)f(trans-)1020 1050 y(formers)16
b(\(such)g(as)g(between)f Fq(StateT)h Fr(and)f Fq(EnvT)p Fr(\),)i(but)e
(doing)h(so)1020 1092 y(to)k(others)f(\(such)g(as)f Fq(ContT)p
Fr(\))i(may)e(ef)o(fect)j(semantics.)40 b(This)19 b(is)1020
1133 y(consistent)13 b(with)h(Filinski's)f(observations)g([6],)i(and,)g(in)e
(practice,)1020 1175 y(pr)o(ovides)d(us)f(an)f(opportunity)i(to)g(\256ne)f
(tune)f(the)i(r)o(esulting)e(seman-)1020 1216 y(tics.)1076
1258 y(In)14 b(lifting)g Fq(callcc)h Fr(thr)o(ough)f(\252)p
Fq(StateT)g(s)p Fr(\272,)h(we)f(have)g(a)g(choice)f(of)1020
1299 y(passing)g(either)h(the)g(curr)o(ent)f(state)h Fe(s)1579
1303 y Fk(1)1607 1299 y Fr(or)g(the)g(captur)o(ed)g(state)g
Fe(s)1993 1303 y Fk(0)2007 1299 y Fr(.)1020 1341 y(The)d(former)g(is)f(the)h
(usual)f(semantics)f(for)j Fq(callcc)p Fr(,)g(and)e(the)h(latter)g(is)1020
1382 y(useful)f(in)g(T)m(olmach)f(and)g(Appel's)j(appr)o(oach)e(to)h
(debugging)d([20].)1039 1456 y Fh(instance)h Fg(\()p Fq(MonadT)g
Fg(\()p Fe(S)r(tateT)17 b(s)p Fg(\))10 b Fe(m;)16 b Fq(ContMonad)9
b Fe(m)p Fg(\))i Ff(\))1412 1498 y Fq(ContMonad)e Fg(\()p Fq(StateT)h
Fe(s)g(m)p Fg(\))h Fh(where)1039 1539 y Fr(-)g(-)19 b Fq(callcc)77
b Fr(::)43 b Fg(\(\()p Fe(a)11 b Ff(!)g Fe(s)g Ff(!)g Fe(m)f
Fg(\()p Fe(s;)c(b)p Fg(\)\))11 b Ff(!)g Fe(s)g Ff(!)g Fe(m)f
Fg(\()p Fe(s;)c(a)p Fg(\)\))1388 1581 y Ff(!)11 b Fe(s)g Ff(!)g
Fe(m)f Fg(\()p Fe(s;)c(a)p Fg(\))1093 1622 y Fq(callcc)11 b
Fe(f)41 b Fg(=)c Ff(n)p Fe(s)1350 1626 y Fk(0)1376 1622 y Ff(!)11
b Fq(callcc)g Fg(\()p Ff(n)p Fe(k)h Ff(!)1351 1664 y Fe(f)i
Fg(\()p Ff(n)p Fe(a)d Ff(!)g(n)p Fe(s)1535 1668 y Fk(1)1560
1664 y Ff(!)g Fe(k)h Fg(\()p Fe(s)1674 1668 y Fk(1)1688 1664
y Fe(;)6 b(a)p Fg(\)\))11 b Fe(s)1784 1668 y Fk(0)1798 1664
y Fg(\))1076 1737 y Fr(The)i(above)f(shows)h(the)g(usual)f
Fq(callcc)i Fr(semantics,)e(and)h(can)f(be)1020 1779 y(changed)e(to)i(the)f
(\252debugging\272)d(version)j(by)g(instead)g(passing)f(\()p
Fe(s)1992 1783 y Fk(0)2007 1779 y Fr(,)1020 1820 y(a\))h(to)g
Fq(k)p Fr(.)1076 1862 y(The)i(lifting)g(of)h Fq(inEnv)f Fr(thr)o(ough)g
Fq(Err)o(orT)e Fr(can)h(be)h(found)h(in)e(the)1020 1903 y(Appendix.)1020
2002 y Fs(8.4)41 b(Lifting)8 b Fq(InEnv)1020 2069 y Fr(W)m(e)21
b(only)g(consider)e(lifting)i Fq(inEnv)f Fr(thr)o(ough)h Fq(ContT)f
Fr(her)o(e;)26 b(the)1020 2111 y(Appendix)18 b(shows)g(how)g(to)g(lift)h
Fq(inEnv)e Fr(thr)o(ough)g(other)h(monad)1020 2152 y(transformers.)1039
2224 y Fh(instance)9 b Fg(\()p Fq(MonadT)g Fg(\()p Fq(ContT)h(ans)o
Fg(\))g Fe(m;)17 b Fq(EnvMonad)8 b Fe(r)k(m)p Fg(\))e Ff(\))1412
2266 y Fq(EnvMonad)f Fe(r)j Fg(\()p Fq(ContT)e(ans)f Fe(m)p
Fg(\))h Fh(where)1095 2308 y Fq(inEnv)g Fe(r)h(c)37 b Fg(=)h
Ff(n)p Fe(k)12 b Ff(!)29 b Fq(rdEnv)9 b Fr(`)p Fq(bind)q Fr(`)h
Ff(n)p Fe(o)h Ff(!)1467 2349 y Fq(inEnv)f Fe(r)i Fg(\()p Fe(c)e
Fg(\()p Fq(inEnv)g Fe(o)e Ff(\001)g Fe(k)q Fg(\)\))1095 2391
y Fq(rdEnv)89 b Fg(=)38 b Fq(lift)12 b(rdEnv)1076 2472 y Fr(W)m(e)e(r)o
(estor)o(e)g(the)g(envir)o(onment)g(befor)o(e)g(invoking)f(the)h(continu-)
1020 2514 y(ation,)k(sort)e(of)i(like)e(popping)i(ar)o(guments)d(of)o(f)j
(the)f(stack.)21 b(On)12 b(the)1020 2555 y(other)e(hand,)g(an)f(inter)o
(esting)g(\(but)h(not)h(natural\))e(way)h(to)g(lift)h Fq(inEnv)1020
2597 y Fr(is:)961 2747 y(9)p eop
%%Page: 10 10
10 9 bop -57 -47 a Fh(instance)9 b Fg(\()p Fq(MonadT)g Fg(\()p
Fq(ContT)h(ans)o Fg(\))g Fe(m;)17 b Fq(EnvMonad)8 b Fe(r)k(m)p
Fg(\))e Ff(\))316 -5 y Fq(EnvMonad)f Fe(r)j Fg(\()p Fq(ContT)e(ans)f
Fe(m)p Fg(\))h Fh(where)-1 36 y Fq(inEnv)g Fe(r)h(c)37 b Fg(=)h
Ff(n)p Fe(k)12 b Ff(!)f Fq(inEnv)f Fe(r)h Fg(\()p Fe(c)f(k)q
Fg(\))-1 78 y Fq(rdEnv)89 b Fg(=)38 b Fq(lift)12 b(rdEnv)-20
151 y Fr(Her)o(e)h(the)g(envir)o(onment)f(is)h(not)g(r)o(estor)o(ed)g(when)g
Fq(c)g Fr(invokes)f Fq(k)p Fr(,)-76 193 y(and)e(thus)f(r)o(e\257ects)h(the)g
(history)g(of)h(dynamic)e(execution.)-76 296 y Fs(9)41 b(Conclusions)-76
377 y Fr(W)m(e)18 b(have)f(shown)g(how)h(a)g(modular)e(monadic)h(interpr)o
(eter)g(can)-76 419 y(be)j(designed)g(using)f(two)j(key)e(ideas:)35
b Fq(extensible)20 b(union)g(types)-76 460 y Fr(and)13 b Fq(monad)e
(transformers)p Fr(,)h(and)g(implemented)h(using)f Fq(constructor)-76
502 y(classes)p Fr(.)25 b(A)14 b(key)g(technical)f(pr)o(oblem)h(that)g(we)h
(had)e(to)i(over)o(come)-76 543 y(was)k(the)g(lifting)g(of)h(operations)g
(thr)o(ough)e(monads.)41 b(Our)19 b(ap-)-76 585 y(pr)o(oach)10
b(also)g(helps)g(to)h(clarify)e(the)h(interactions)f(between)g(various)-76
626 y(pr)o(ogramming)h(language)e(featur)o(es.)-20 668 y(This)14
b(paper)i(r)o(ealized)d(Moggi's)j(idea)e(of)i(a)e(modular)g(pr)o(esen-)-76
710 y(tation)e(of)g(denotational)f(semantics)f(for)i(complicated)f
(languages,)-76 751 y(and)g(is)h(much)f(cleaner)g(than)g(the)h(traditional)f
(appr)o(oach)h([19].)20 b(On)-76 793 y(the)g(practical)f(side,)j(our)e(r)o
(esults)g(pr)o(ovide)g(new)g(insights)f(into)-76 834 y(designing)e(and)h
(implementing)g(pr)o(ogramming)h(languages,)g(in)-76 876 y(particular)m(,)13
b(extensible)g(languages,)f(which)h(allow)h(the)f(pr)o(ogram-)-76
917 y(mer)d(to)h(specify)f(new)h(featur)o(es)e(on)i(top)g(of)h(existing)d
(ones.)-76 1020 y Fs(Ackno)o(wledgements)-76 1102 y Fr(W)m(e)i(thank)f(Dan)g
(Rabin,)h(Zhong)f(Shao,)h(Rajiv)f(Mirani)g(and)h(anony-)-76
1143 y(mous)f(r)o(efer)o(ees)h(for)g(helpful)f(suggestions.)-76
1246 y Fs(References)-57 1328 y Fr([1])19 b(Andr)o(ew)24 b(W)m(.)h(Appel)g
(and)e(T)m(r)o(evor)h(Jim.)43 b(Continuation-)5 1369 y(passing,)16
b(closur)o(e-passing)d(style.)24 b(In)14 b Fq(ACM)h(Symposium)e(on)5
1411 y(Principles)8 b(of)h(Pr)o(ogramming)d(Languages)p Fr(,)h(pages)h
(193\261302,)f(Jan-)5 1452 y(uary)i(1989.)-57 1524 y([2])19
b(Adrienne)i(Bloss,)j(Paul)d(Hudak,)j(and)d(Jonathan)g(Y)m(oung.)5
1565 y(Code)8 b(optimization)g(for)g(lazy)f(evaluation.)i Fq(Lisp)e(and)g
(Symbolic)5 1607 y(Computation)p Fr(,)j(1\(1\):147\261164,)f(1988.)-57
1678 y([3])19 b(Robert)d(Cartwright)f(and)g(Matthias)g(Felleisen.)24
b(Extensible)5 1720 y(denotational)11 b(semantics.)17 b(In)11
b Fq(Pr)o(oceedings)f(of)i(Symposium)e(on)5 1761 y(Theor)o(etical)i(Aspects)f
(of)i(Computer)e(Softwar)o(e)p Fr(,)i(pages)f(244\261272,)5
1803 y(1994.)-57 1874 y([4])19 b(David)11 b(Espinosa.)16 b(Modular)10
b(denotational)h(semantics.)k(Un-)5 1916 y(published)9 b(manuscript,)g
(December)g(1993.)-57 1987 y([5])19 b(David)11 b(Espinosa.)16
b(Building)9 b(interpr)o(eters)i(by)f(transforming)5 2029 y(strati\256ed)k
(monads.)23 b(Unpublished)14 b(manuscript,)h(ftp)h(fr)o(om)5
2070 y(altdorf.ai.mit.edu:pub/dae,)10 b(June)g(1994.)-57 2141
y([6])19 b(Andrzej)13 b(Filinski.)22 b(Repr)o(esenting)14 b(monads.)22
b(In)14 b Fq(Confer)o(ence)5 2183 y(Record)d(of)h(POPL)g('94:)18
b(21st)12 b(ACM)g(SIGPLAN-SIGACT)g(Sym-)5 2225 y(posium)e(on)g(Principles)g
(of)g(Pr)o(ogramming)f(Languages,)f(Portland,)5 2266 y(Or)o(egon)p
Fr(,)j(pages)h(446\261457,)f(New)h(Y)m(ork,)g(January)e(1994.)i(ACM)5
2308 y(Pr)o(ess.)-57 2379 y([7])19 b(Paul)14 b(Hudak,)h(Simon)g(Peyton)g
(Jones,)i(and)d(Philip)h(W)m(adler)m(.)5 2420 y(Report)e(on)g(the)g(pr)o
(ogramming)f(language)f(Haskell:)19 b(a)12 b(non-)5 2462 y(strict,)c(pur)o
(ely)g(functional)f(language,)g(version)h(1.2.)j(T)m(echnical)5
2503 y(Report)k(Y)m(ALEU/DCS/RR-777,)f(Y)m(ale)f(University)g(Depart-)5
2545 y(ment)f(of)i(Computer)f(Science,)f(Mar)o(ch)g(1992.)18
b(Also)12 b(in)h(ACM)5 2586 y(SIGPLAN)c(Notices,)h(V)l(ol.)h(27\(5\),)g(May)f
(1992.)1039 -34 y([8])19 b(Mark)e(P)-5 b(.)18 b(Jones.)30 b(Intr)o(oduction)
16 b(to)j(gofer)f(2.20.)28 b(Ftp)18 b(fr)o(om)1101 7 y(nebula.cs.yale.edu)11
b(in)j(the)g(dir)o(ectory)f(pub/haskell/gofer)m(,)1101 49 y(September)d
(1991.)1039 119 y([9])19 b(Mark)13 b(P)-5 b(.)13 b(Jones.)21
b(A)13 b(system)g(of)h(constructor)e(classes:)19 b(Over)o(-)1101
160 y(loading)e(and)f(implicit)i(higher)o(-or)o(der)e(polymorphism.)30
b(In)1101 202 y Fq(FPCA)16 b('93:)28 b(Confer)o(ence)16 b(on)g(Functional)h
(Pr)o(ogramming)e(Lan-)1101 243 y(guages)10 b(and)h(Computer)g(Ar)o
(chitectur)o(e,)h(Copenhagen,)e(Denmark)p Fr(,)1101 285 y(pages)g(52\26161,)f
(New)i(Y)m(ork,)f(June)g(1993.)f(ACM)i(Pr)o(ess.)1020 355 y([10])19
b(Mark)12 b(P)-5 b(.)13 b(Jones)g(and)f(Luc)g(Duponcheel.)18
b(Composing)c(mon-)1101 397 y(ads.)f(Resear)o(ch)c(Report)h(Y)m
(ALEU/DCS/RR-1004,)e(Y)m(ale)h(Uni-)1101 438 y(versity)i(Department)g(of)h
(Computer)h(Science,)d(New)h(Haven,)1101 480 y(Connecticut,)f(December)f
(1993.)1020 550 y([11])19 b(Richar)o(d)10 b(Kelsey)h(and)g(Paul)g(Hudak.)16
b(Realistic)10 b(compilation)1101 592 y(by)d(pr)o(ogram)g(transformation.)j
(In)d Fq(ACM)h(Symposium)e(on)g(Prin-)1101 633 y(ciples)j(of)h(Pr)o
(ogramming)d(Languages)p Fr(,)g(pages)i(181\261192,)f(January)1101
675 y(1989.)1020 745 y([12])19 b(Amir)13 b(Kishon,)g(Paul)f(Hudak,)h(and)f
(Charles)g(Consel.)20 b(Mon-)1101 786 y(itoring)12 b(semantics:)18
b(A)13 b(formal)f(framework)h(for)g(specifying,)1101 828 y(implementing)8
b(and)g(r)o(easoning)g(about)h(execution)f(monitors.)1101 869
y(In)16 b Fq(Pr)o(oceedings)d(of)j(the)g(ACM)h(SIGPLAN)f('91)g(Confer)o(ence)
e(on)1101 911 y(Pr)o(ogramming)8 b(Language)f(Design)i(and)g(Implementation)p
Fr(,)h(pages)1101 952 y(338\261352,)e(June)i(1991.)1020 1023
y([13])19 b(Peter)10 b(Lee.)16 b Fq(Realistic)11 b(Compiler)f(Generation)p
Fr(.)15 b(Foundations)9 b(of)1101 1064 y(Computing.)i(MIT)f(Pr)o(ess,)g
(1989.)1020 1134 y([14])19 b(Robin)h(Milner)m(,)i(Mads)e(T)m(ofte,)j(and)c
(Robert)h(Harper)m(.)33 b Fq(The)1101 1176 y(De\256nition)10
b(of)g(Standard)f(ML)p Fr(.)15 b(MIT)10 b(Pr)o(ess,)g(1990.)1020
1246 y([15])19 b(Eugenio)9 b(Moggi.)14 b(An)9 b(abstract)g(view)h(of)g(pr)o
(ogramming)g(lan-)1101 1288 y(guages.)h(T)m(echnical)c(Report)i
(ECS-LFCS-90-113,)g(Laboratory)1101 1329 y(for)20 b(Foundations)e(of)j
(Computer)f(Science,)g(University)e(of)1101 1371 y(Edinbur)o(gh,)9
b(Edinbur)o(gh,)g(Scotland,)g(1990.)1020 1441 y([16])19 b(Peter)24
b(D.)h(Mosses.)44 b(A)25 b(basic)f(abstract)f(semantic)h(alge-)1101
1482 y(bra.)29 b(In)18 b(Gilles)f(Kahn,)j(David)e(B.)g(MacQueen,)h(and)f(Gor)
o(-)1101 1524 y(don)10 b(D.)g(Plotkin,)g(editors,)g Fq(Semantics)f(of)h(Data)
f(T)m(ypes:)k(Interna-)1101 1565 y(tional)c(Symposium,)g(Sophia-Antipolis,)g
(France)p Fr(,)f(pages)h(87\261107.)1101 1607 y(Springer)o(-V)l(erlag,)g
(June)g(1984.)k(Lectur)o(e)c(Notes)h(in)g(Computer)1101 1648
y(Science)f(173.)1020 1719 y([17])19 b(Simon)h(Peyton)g(Jones)h(and)e(Philip)
h(W)m(adler)m(.)34 b(Imperative)1101 1760 y(functional)8 b(pr)o(ogramming.)j
(In)d Fq(Pr)o(oceedings)e(20th)i(Symposium)1101 1802 y(on)19
b(Principles)f(of)h(Pr)o(ogramming)f(Languages)p Fr(,)h(pages)g(71\26184.)
1101 1843 y(ACM,)12 b(January)d(1993.)1020 1913 y([18])19 b(Guy)c(L.)h
(Steele)f(Jr)m(.)27 b(Building)14 b(interpr)o(eters)i(by)f(composing)1101
1955 y(monads.)24 b(In)14 b Fq(Confer)o(ence)f(Record)g(of)i(POPL)g('94:)24
b(21st)14 b(ACM)1101 1997 y(SIGPLAN-SIGACT)g(Symposium)e(on)h(Principles)g
(of)h(Pr)o(ogram-)1101 2038 y(ming)f(Languages,)f(Portland,)h(Or)o(egon)p
Fr(,)h(pages)f(472\261492,)f(New)1101 2080 y(Y)m(ork,)e(January)f(1994.)h
(ACM)h(Pr)o(ess.)1020 2150 y([19])19 b(Joseph)c(Stoy)l(.)23
b Fq(Denotational)13 b(Semantics:)23 b(The)13 b(Scott-Strachey)1101
2191 y(Appr)o(oach)h(to)h(Pr)o(ogramming)e(Language)g(Theory)p
Fr(.)23 b(MIT)15 b(Pr)o(ess,)1101 2233 y(1977.)1020 2303 y([20])k(Andr)o(ew)9
b(P)-5 b(.)10 b(T)m(olmach)e(and)h(Andr)o(ew)g(W)m(.)h(Appel.)k(Debugging)
1101 2345 y(standar)o(d)f(ML)h(without)g(r)o(everse)f(engineering.)19
b(In)14 b Fq(Pr)o(oceed-)1101 2386 y(ings)g(of)g(the)g(1990)f(ACM)h(Confer)o
(ence)e(on)i(Lisp)f(and)h(Functional)1101 2428 y(Pr)o(ogramming)p
Fr(,)9 b(Nice,)h(France,)f(June)h(1990.)1020 2498 y([21])19
b(Philip)i(W)m(adler)m(.)37 b(The)22 b(essence)e(of)j(functional)e(pr)o
(ogram-)1101 2539 y(ming.)34 b(In)20 b Fq(Confer)o(ence)f(Record)g(of)h(the)g
(Nineteenth)g(Annual)1101 2581 y(ACM)9 b(Symposium)e(on)g(Principles)h(of)h
(Pr)o(ogramming)d(Languages,)1101 2622 y(Albuquer)o(que,)k(New)g(Mexico)p
Fr(,)h(pages)f(1\26114,)f(January)g(1992.)952 2747 y(10)p eop
%%Page: 11 11
11 10 bop -76 -34 a Fr([22])19 b(Philip)11 b(L.)h(W)m(adler)m(.)17
b(Compr)o(ehending)12 b(monads.)17 b(In)11 b Fq(Pr)o(oceed-)5
7 y(ings)j(of)g(the)g(1990)f(ACM)h(Confer)o(ence)e(on)i(Lisp)f(and)h
(Functional)5 49 y(Pr)o(ogramming)p Fr(,)9 b(1990.)-76 120
y([23])19 b(Mitchell)14 b(W)m(and.)21 b(A)14 b(semantic)f(pr)o(ototyping)j
(system.)22 b Fq(SIG-)5 162 y(PLAN)7 b(Notices,)g(ACM)g(Symposium)f(on)g
(Compiler)g(Construction)p Fr(,)5 203 y(19\(6\):213\261221,)j(1984.)-76
306 y Fs(A)42 b(The)10 b(Ordering)f(of)h Fq(ContT)g Fs(and)g
Fq(EnvT)-76 388 y Fr(It)f(is)g(inter)o(esting)f(to)h(compar)o(e)g(the)g
(following)g(two)h Fq(callcc)g Fr(functions)-76 429 y(on)j(monad)f
Fq(M)h Fr(and)f Fq(N)p Fr(,)h(both)g(composed)g(fr)o(om)g(\252)p
Fq(ContT)f(ans)p Fr(\272)f(and)-76 471 y(\252)p Fq(EnvT)e(m)p
Fr(\272,)i(but)f(in)g(dif)o(fer)o(ent)h(or)o(der)m(.)-76 554
y(Case)f(1:)-57 618 y Fh(type)g Fe(M)k(a)38 b Fg(=)f Fq(ContT)10
b(ans)g Fg(\()p Fq(EnvT)f Fe(r)j(m)p Fg(\))e Fe(a)137 659 y
Fg(=)37 b(\()p Fe(a)11 b Ff(!)g Fe(r)h Ff(!)f Fe(m)g Fq(ans)o
Fg(\))f Ff(!)h Fe(r)h Ff(!)f Fe(m)g Fq(ans)-57 743 y(callcc)g
Fe(f)41 b Fg(=)c Ff(n)p Fe(k)12 b Ff(!)f Fe(f)k Fg(\()p Ff(n)p
Fe(a)c Ff(!)g(n)p 432 743 12 2 v 24 w(!)g Fe(k)h(a)p Fg(\))e
Fe(k)163 785 y Fr(\(eta)h(convert)f Ff(n)p Fe(r)i Fr(and)e
Ff(n)p Fe(r)529 769 y Fd(0)540 785 y Fr(\))96 827 y Fg(=)37
b Ff(n)p Fe(k)12 b Ff(!)f(n)p Fe(r)i Ff(!)e Fe(f)j Fg(\()p
Ff(n)p Fe(a)d Ff(!)g(n)p 529 827 V 24 w(!)g(n)p Fe(r)637 811
y Fd(0)660 827 y Ff(!)g Fe(k)g(a)g(r)789 811 y Fd(0)801 827
y Fg(\))f Fe(k)i(r)-76 908 y Fr(Case)e(2:)-57 972 y Fh(type)g
Fe(M)k(a)38 b Fg(=)f Fq(EnvT)10 b Fe(r)i Fg(\()p Fq(ContT)d
Fe(ans)i(m)p Fg(\))f Fe(a)137 1013 y Fg(=)37 b Fe(r)12 b Ff(!)f
Fg(\()p Fe(a)g Ff(!)g Fe(m)g Fq(ans)o Fg(\))f Ff(!)h Fe(m)f
Fq(ans)-57 1098 y(callcc)h Fe(f)41 b Fg(=)c Ff(n)p Fe(r)13
b Ff(!)e Fq(callcc)g Fg(\()p Ff(n)p Fe(k)h Ff(!)f Fe(f)j Fg(\()p
Ff(n)p Fe(a)d Ff(!)g(n)p Fe(r)653 1082 y Fd(0)676 1098 y Ff(!)g
Fe(k)g(a)p Fg(\))g Fe(r)q Fg(\))96 1140 y(=)37 b Ff(n)p Fe(r)13
b Ff(!)e(n)p Fe(k)h Ff(!)f Fg(\()p Ff(n)p Fe(k)416 1124 y Fd(0)438
1140 y Ff(!)g Fe(f)j Fg(\()p Ff(n)p Fe(a)d Ff(!)g(n)p Fe(r)671
1124 y Fd(0)694 1140 y Ff(!)g Fe(k)764 1124 y Fd(0)785 1140
y Fe(a)p Fg(\))g Fe(r)q Fg(\))388 1181 y(\()p Ff(n)p Fe(a)g
Ff(!)g(n)p 523 1181 V 24 w(!)g Fe(k)h(a)p Fg(\))e Fe(k)96 1224
y Fg(=)37 b Ff(n)p Fe(r)13 b Ff(!)e(n)p Fe(k)h Ff(!)f Fe(f)j
Fg(\()p Ff(n)p Fe(a)d Ff(!)g(n)p Fe(r)545 1208 y Fd(0)568 1224
y Ff(!)g(n)p 638 1224 V 24 w(!)g Fe(k)g(a)p Fg(\))g Fe(r)h(k)-20
1305 y Fr(Fr)o(om)g(the)f(expansion)h(of)g(type)g Fq(M)f Fr(in)g(case)g(1,)h
(we)f(can)g(see)g(that)-76 1347 y(both)g(r)o(esult)f(and)f(envir)o(onment)i
(ar)o(e)f(passed)g(to)h(the)f(continuation.)-76 1388 y(When)18
b Fq(callcc)h Fr(invokes)e(a)h(continuation,)h(it)f(passes)f(the)h
Fq(curr)o(ent)p Fr(,)-76 1430 y(rather)10 b(than)f(the)h(captur)o(ed)g
(continuation.)k(The)c Fq(callcc)h Fr(function)f(in)-76 1471
y(case)g(2)g(works)g(in)g(the)g(opposite)i(way)l(.)-76 1574
y Fs(B)42 b(Lifting)8 b Fq(Callcc)j Fs(through)e Fq(Err)o(orT)-57
1655 y Fh(instance)g Fg(\()p Fq(MonadT)g Fe(E)r(r)q(r)q(or)q(T)18
b(m;)e Fq(ContMonad)9 b Fe(m)p Fg(\))h Ff(\))316 1697 y Fq(ContMonad)f
Fg(\()p Fq(Err)o(orT)g Fe(m)p Fg(\))h Fh(where)-53 1738 y Fr(-)g(-)38
b Fq(callcc)77 b Fr(::)44 b Fg(\(\()p Fe(a)11 b Ff(!)g Fe(m)f
Fg(\()p Fq(Err)o(or)f Fe(a)p Fg(\)\))h Ff(!)i Fe(m)e Fg(\()p
Fq(Err)o(or)e Fe(a)p Fg(\)\))-53 1780 y Fr(-)i(-)334 b Ff(!)11
b Fe(m)f Fg(\()p Fq(Err)o(or)e Fe(a)p Fg(\))19 1821 y Fq(callcc)k
Fe(f)41 b Fg(=)c Fq(callcc)11 b Fg(\()p Ff(n)p Fe(k)h Ff(!)f
Fe(f)j Fg(\()p Ff(n)p Fe(a)d Ff(!)g Fe(k)h Fg(\()p Fq(Ok)e
Fe(a)p Fg(\)\)\))-76 1926 y Fs(C)42 b(Lifting)8 b Fq(InEnv)i
Fs(through)f Fq(EnvT)p Fs(,)h Fq(StateT)g Fs(and)g Fq(Err)o(orT)-57
2007 y Fh(instance)f Fg(\()p Fq(MonadT)g Fg(\()p Fq(EnvT)h
Fe(r)379 1991 y Fd(0)390 2007 y Fg(\))h Fe(m;)16 b Fq(EnvMonad)8
b Fe(r)k(m)p Fg(\))f Ff(\))316 2049 y Fq(EnvMonad)e Fe(r)j
Fg(\()p Fq(EnvT)d Fe(r)654 2034 y Fd(0)676 2049 y Fe(m)p Fg(\))h
Fh(where)-1 2092 y Fq(inEnv)g Fe(r)h(m)38 b Fg(=)f Ff(n)p Fe(r)307
2076 y Fd(0)329 2092 y Ff(!)11 b Fq(inEnv)f Fe(r)i Fg(\()p
Fe(m)e(r)588 2076 y Fd(0)600 2092 y Fg(\))-1 2133 y Fq(rdEnv)107
b Fg(=)37 b Fq(lift)12 b(rdEnv)-57 2217 y Fh(instance)d Fg(\()p
Fq(MonadT)g Fg(\()p Fq(StateT)h Fe(s)p Fg(\))g Fe(m;)17 b Fq(EnvMonad)8
b Fe(r)k(m)p Fg(\))e Ff(\))316 2259 y Fq(EnvMonad)f Fe(r)j
Fg(\()p Fq(StateT)e Fe(s)g(m)p Fg(\))g Fh(where)-1 2300 y Fq(inEnv)g
Fe(r)h(m)38 b Fg(=)f Ff(n)p Fe(s)11 b Ff(!)g Fq(inEnv)f Fe(r)h
Fg(\()p Fe(m)f(s)p Fg(\))-1 2342 y Fq(rdEnv)107 b Fg(=)37 b
Fq(lift)12 b(rdEnv)-20 2423 y Fr(A)j(function)e(of)j(type)e(\252)p
Fq(m)g(a)g Ff(!)h Fq(m)g(a)p Fr(\272)e(maps)i(\252)p Fq(m)f(\(Err)o(or)f(a\))
p Fr(\272)h(to)-76 2465 y(\252)p Fq(m)h(\(Err)o(or)g(a\))p
Fr(\272,)h(thus)f Fq(inEnv)g Fr(stays)g(the)g(same)g(after)g(being)f(lifted)
-76 2506 y(thr)o(ough)c Fq(Err)o(orT)p Fr(.)952 2747 y(11)p
eop
%%Trailer
end
userdict /end-hook known{end-hook}if
%%EOF
